import{E as Le,M as bt,F as qn,G as Gn,H as _e,I as Nr,J as Z,K as on,L as un,N as kt,S as xt,i as Ot,s as Et,e as ae,a as je,O as On,c as re,d as te,p as Xe,l as Fe,P as At,n as En,f as ie,r as Br,Q as Oe,R as St,T as It,U as lr,V as jt,W as Ft}from"./index-7250794f.js";Le(C,Error);function C(e,n,r){Error.call(this,r),this.status=e,this.name=n,this.message=r,this.error=!0}C.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};new C(401,"unauthorized","Name or password is incorrect.");new C(400,"bad_request","Missing JSON list of 'docs'");new C(404,"not_found","missing");new C(409,"conflict","Document update conflict");new C(400,"bad_request","_id field must contain a string");new C(412,"missing_id","_id is required for puts");new C(400,"bad_request","Only reserved document ids may start with underscore.");new C(412,"precondition_failed","Database not open");var Ct=new C(500,"unknown_error","Database encountered an unknown error");new C(500,"badarg","Some query argument is invalid");new C(400,"invalid_request","Request was invalid");new C(400,"query_parse_error","Some query parameter is invalid");new C(500,"doc_validation","Bad special document member");new C(400,"bad_request","Something wrong with the request");new C(400,"bad_request","Document must be a JSON object");new C(404,"not_found","Database not found");new C(500,"indexed_db_went_bad","unknown");new C(500,"web_sql_went_bad","unknown");new C(500,"levelDB_went_went_bad","unknown");new C(403,"forbidden","Forbidden by design doc validate_doc_update function");new C(400,"bad_request","Invalid rev format");new C(412,"file_exists","The database could not be created, the file already exists.");new C(412,"missing_stub","A pre-existing attachment stub wasn't found");new C(413,"invalid_url","Provided URL is invalid");function An(e){if(typeof e!="object"){var n=e;e=Ct,e.data=n}return"error"in e&&e.error==="conflict"&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),"stack"in e||(e.stack=new Error().stack),e}var Ve=Headers;function fn(e){return"$"+e}function Rr(e){return e.substring(1)}function D(){this._store={}}D.prototype.get=function(e){var n=fn(e);return this._store[n]};D.prototype.set=function(e,n){var r=fn(e);return this._store[r]=n,!0};D.prototype.has=function(e){var n=fn(e);return n in this._store};D.prototype.keys=function(){return Object.keys(this._store).map(e=>Rr(e))};D.prototype.delete=function(e){var n=fn(e),r=n in this._store;return delete this._store[n],r};D.prototype.forEach=function(e){for(var n=Object.keys(this._store),r=0,t=n.length;r<t;r++){var i=n[r],a=this._store[i];i=Rr(i),e(a,i)}};Object.defineProperty(D.prototype,"size",{get:function(){return Object.keys(this._store).length}});function Ne(e){if(this._store=new D,e&&Array.isArray(e))for(var n=0,r=e.length;n<r;n++)this.add(e[n])}Ne.prototype.add=function(e){return this._store.set(e,!0)};Ne.prototype.has=function(e){return this._store.has(e)};Ne.prototype.forEach=function(e){this._store.forEach(function(n,r){e(r)})};Object.defineProperty(Ne.prototype,"size",{get:function(){return this._store.size}});function Tt(){if(typeof Symbol>"u"||typeof Map>"u"||typeof Set>"u")return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}var Ce,me;Tt()?(Ce=Set,me=Map):(Ce=Ne,me=D);var Pt=function(e){return atob(e)};function Lt(e,n){e=e||[],n=n||{};try{return new Blob(e,n)}catch(a){if(a.name!=="TypeError")throw a;for(var r=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,t=new r,i=0;i<e.length;i+=1)t.append(e[i]);return t.getBlob(n.type)}}function Nt(e){for(var n=e.length,r=new ArrayBuffer(n),t=new Uint8Array(r),i=0;i<n;i++)t[i]=e.charCodeAt(i);return r}function Bt(e,n){return Lt([Nt(e)],{type:n})}function Rt(e,n){return Bt(Pt(e),n)}function Ut(e,n,r){for(var t="",i=r-e.length;t.length<i;)t+=n;return t}function zt(e,n,r){var t=Ut(e,n,r);return t+e}var Ur=-324,Sn=3,In="";function U(e,n){if(e===n)return 0;e=de(e),n=de(n);var r=jn(e),t=jn(n);if(r-t!==0)return r-t;switch(typeof e){case"number":return e-n;case"boolean":return e<n?-1:1;case"string":return Kt(e,n)}return Array.isArray(e)?Gt(e,n):Wt(e,n)}function de(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var n=e;if(Array.isArray(e)){var r=e.length;e=new Array(r);for(var t=0;t<r;t++)e[t]=de(n[t])}else{if(e instanceof Date)return e.toJSON();if(e!==null){e={};for(var i in n)if(Object.prototype.hasOwnProperty.call(n,i)){var a=n[i];typeof a<"u"&&(e[i]=de(a))}}}}return e}function Qt(e){if(e!==null)switch(typeof e){case"boolean":return e?1:0;case"number":return Ht(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var n=Array.isArray(e),r=n?e:Object.keys(e),t=-1,i=r.length,a="";if(n)for(;++t<i;)a+=K(r[t]);else for(;++t<i;){var o=r[t];a+=K(o)+K(e[o])}return a}return""}function K(e){var n="\0";return e=de(e),jn(e)+In+Qt(e)+n}function Mt(e,n){var r=n,t,i=e[n]==="1";if(i)t=0,n++;else{var a=e[n]==="0";n++;var o="",u=e.substring(n,n+Sn),f=parseInt(u,10)+Ur;for(a&&(f=-f),n+=Sn;;){var c=e[n];if(c==="\0")break;o+=c,n++}o=o.split("."),o.length===1?t=parseInt(o,10):t=parseFloat(o[0]+"."+o[1]),a&&(t=t-10),f!==0&&(t=parseFloat(t+"e"+f))}return{num:t,length:n-r}}function Jt(e,n){var r=e.pop();if(n.length){var t=n[n.length-1];r===t.element&&(n.pop(),t=n[n.length-1]);var i=t.element,a=t.index;if(Array.isArray(i))i.push(r);else if(a===e.length-2){var o=e.pop();i[o]=r}else e.push(r)}}function qt(e){for(var n=[],r=[],t=0;;){var i=e[t++];if(i==="\0"){if(n.length===1)return n.pop();Jt(n,r);continue}switch(i){case"1":n.push(null);break;case"2":n.push(e[t]==="1"),t++;break;case"3":var a=Mt(e,t);n.push(a.num),t+=a.length;break;case"4":for(var o="";;){var u=e[t];if(u==="\0")break;o+=u,t++}o=o.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),n.push(o);break;case"5":var f={element:[],index:n.length};n.push(f.element),r.push(f);break;case"6":var c={element:{},index:n.length};n.push(c.element),r.push(c);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}}}function Gt(e,n){for(var r=Math.min(e.length,n.length),t=0;t<r;t++){var i=U(e[t],n[t]);if(i!==0)return i}return e.length===n.length?0:e.length>n.length?1:-1}function Kt(e,n){return e===n?0:e>n?1:-1}function Wt(e,n){for(var r=Object.keys(e),t=Object.keys(n),i=Math.min(r.length,t.length),a=0;a<i;a++){var o=U(r[a],t[a]);if(o!==0||(o=U(e[r[a]],n[t[a]]),o!==0))return o}return r.length===t.length?0:r.length>t.length?1:-1}function jn(e){var n=["boolean","number","string","object"],r=n.indexOf(typeof e);if(~r)return e===null?1:Array.isArray(e)?5:r<3?r+2:r+3;if(Array.isArray(e))return 5}function Ht(e){if(e===0)return"1";var n=e.toExponential().split(/e\+?/),r=parseInt(n[1],10),t=e<0,i=t?"0":"2",a=(t?-r:r)-Ur,o=zt(a.toString(),"0",Sn);i+=In+o;var u=Math.abs(parseFloat(n[0]));t&&(u=10-u);var f=u.toFixed(20);return f=f.replace(/\.?0+$/,""),i+=In+f,i}function zr(e){return bt.hash(e)}function Xt(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer||typeof Blob<"u"&&e instanceof Blob}function Yt(e){if(typeof e.slice=="function")return e.slice(0);var n=new ArrayBuffer(e.byteLength),r=new Uint8Array(n),t=new Uint8Array(e);return r.set(t),n}function Zt(e){if(e instanceof ArrayBuffer)return Yt(e);var n=e.size,r=e.type;return typeof e.slice=="function"?e.slice(0,n,r):e.webkitSlice(0,n,r)}var Qr=Function.prototype.toString,Vt=Qr.call(Object);function Dt(e){var n=Object.getPrototypeOf(e);if(n===null)return!0;var r=n.constructor;return typeof r=="function"&&r instanceof r&&Qr.call(r)==Vt}function oe(e){var n,r,t;if(!e||typeof e!="object")return e;if(Array.isArray(e)){for(n=[],r=0,t=e.length;r<t;r++)n[r]=oe(e[r]);return n}if(e instanceof Date&&isFinite(e))return e.toISOString();if(Xt(e))return Zt(e);if(!Dt(e))return e;n={};for(r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var i=oe(e[r]);typeof i<"u"&&(n[r]=i)}return n}function ei(e){var n=!1;return Gn(function(r){if(n)throw new Error("once called more than once");n=!0,e.apply(this,r)})}function Be(e){return Gn(function(n){n=oe(n);var r=this,t=typeof n[n.length-1]=="function"?n.pop():!1,i=new Promise(function(a,o){var u;try{var f=ei(function(c,g){c?o(c):a(g)});n.push(f),u=e.apply(r,n),u&&typeof u.then=="function"&&a(u)}catch(c){o(c)}});return t&&i.then(function(a){t(null,a)},t),i})}function ni(e,n){for(var r={},t=0,i=n.length;t<i;t++){var a=n[t];a in e&&(r[a]=e[a])}return r}var Fn;try{localStorage.setItem("_pouch_check_localstorage",1),Fn=!!localStorage.getItem("_pouch_check_localstorage")}catch{Fn=!1}function Mr(){return Fn}Le(Re,qn);function ri(e){Mr()&&addEventListener("storage",function(n){e.emit(n.key)})}function Re(){qn.call(this),this._listeners={},ri(this)}Re.prototype.addListener=function(e,n,r,t){if(this._listeners[n])return;var i=this,a=!1;function o(){if(!i._listeners[n])return;if(a){a="waiting";return}a=!0;var u=ni(t,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);function f(){a=!1}r.changes(u).on("change",function(c){c.seq>t.since&&!t.cancelled&&(t.since=c.seq,t.onChange(c))}).on("complete",function(){a==="waiting"&&_e(o),a=!1}).on("error",f)}this._listeners[n]=o,this.on(e,o)};Re.prototype.removeListener=function(e,n){n in this._listeners&&(qn.prototype.removeListener.call(this,e,this._listeners[n]),delete this._listeners[n])};Re.prototype.notifyLocalWindows=function(e){Mr()&&(localStorage[e]=localStorage[e]==="a"?"b":"a")};Re.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};function Cn(e){if(typeof console<"u"&&typeof console[e]=="function"){var n=Array.prototype.slice.call(arguments,1);console[e].apply(console,n)}}var Tn;typeof Object.assign=="function"?Tn=Object.assign:Tn=function(e){for(var n=Object(e),r=1;r<arguments.length;r++){var t=arguments[r];if(t!=null)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n};var Kn=Tn;function dr(e){for(var n=[],r=0,t=e.length;r<t;r++)n=n.concat(e[r]);return n}function ve(e){return typeof e._remote=="boolean"?e._remote:typeof e.type=="function"?(Cn("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),e.type()==="http"):!1}function sn(e,n,r){return e.get(n).catch(function(t){if(t.status!==404)throw t;return{}}).then(function(t){var i=t._rev,a=r(t);return a?(a._id=n,a._rev=i,ti(e,a,r)):{updated:!1,rev:i}})}function ti(e,n,r){return e.put(n).then(function(t){return{updated:!0,rev:t.rev}},function(t){if(t.status!==409)throw t;return sn(e,n._id,r)})}function se(e){this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,se)}catch{}}Le(se,Error);function Wn(e){this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Wn)}catch{}}Le(Wn,Error);function Hn(e){this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Hn)}catch{}}Le(Hn,Error);function Jr(e,n){return n&&e.then(function(r){_e(function(){n(null,r)})},function(r){_e(function(){n(r)})}),e}function ii(e){return Gn(function(n){var r=n.pop(),t=e.apply(this,n);return typeof r=="function"&&Jr(t,r),t})}function ai(e,n){return e.then(function(r){return n().then(function(){return r})},function(r){return n().then(function(){throw r})})}function _n(e,n){return function(){var r=arguments,t=this;return e.add(function(){return n.apply(t,r)})}}function vr(e){var n=new Ce(e),r=new Array(n.size),t=-1;return n.forEach(function(i){r[++t]=i}),r}function $n(e){var n=new Array(e.size),r=-1;return e.forEach(function(t,i){n[++r]=i}),n}function Te(){this.promise=new Promise(function(e){e()})}Te.prototype.add=function(e){return this.promise=this.promise.catch(function(){}).then(function(){return e()}),this.promise};Te.prototype.finish=function(){return this.promise};function hr(e){if(!e)return"undefined";switch(typeof e){case"function":return e.toString();case"string":return e.toString();default:return JSON.stringify(e)}}function oi(e,n){return hr(e)+hr(n)+"undefined"}function yr(e,n,r,t,i,a){var o=oi(r,t),u;if(!i&&(u=e._cachedViews=e._cachedViews||{},u[o]))return u[o];var f=e.info().then(function(c){var g=c.db_name+"-mrview-"+(i?"temp":zr(o));function h(y){y.views=y.views||{};var x=n;x.indexOf("/")===-1&&(x=n+"/"+n);var j=y.views[x]=y.views[x]||{};if(!j[g])return j[g]=!0,y}return sn(e,"_local/"+a,h).then(function(){return e.registerDependentDatabase(g).then(function(y){var x=y.db;x.auto_compaction=!0;var j={name:g,db:x,sourceDB:e,adapter:e.adapter,mapFun:r,reduceFun:t};return j.db.get("_local/lastSeq").catch(function(b){if(b.status!==404)throw b}).then(function(b){return j.seq=b?b.seq:0,u&&j.db.once("destroyed",function(){delete u[o]}),j})})})});return u&&(u[o]=f),f}var pr={},gr=new Te,ui=50;function wn(e){return e.indexOf("/")===-1?[e,e]:e.split("/")}function fi(e){return e.length===1&&/^1-/.test(e[0].rev)}function mr(e,n,r){try{e.emit("error",n)}catch{Cn("error",`The user's map/reduce function threw an uncaught error.
You can debug this error by doing:
myDatabase.on('error', function (err) { debugger; });
Please double-check your map/reduce function.`),Cn("error",n,r)}}function si(e,n,r,t){function i(s,l,d){try{l(d)}catch(p){mr(s,p,{fun:l,doc:d})}}function a(s,l,d,p,$){try{return{output:l(d,p,$)}}catch(E){return mr(s,E,{fun:l,keys:d,values:p,rereduce:$}),{error:E}}}function o(s,l){var d=U(s.key,l.key);return d!==0?d:U(s.value,l.value)}function u(s,l,d){return d=d||0,typeof l=="number"?s.slice(d,l+d):d>0?s.slice(d):s}function f(s){var l=s.value,d=l&&typeof l=="object"&&l._id||s.id;return d}function c(s){s.rows.forEach(function(l){var d=l.doc&&l.doc._attachments;d&&Object.keys(d).forEach(function(p){var $=d[p];d[p].data=Rt($.data,$.content_type)})})}function g(s){return function(l){return s.include_docs&&s.attachments&&s.binary&&c(l),l}}function h(s,l,d,p){var $=l[s];typeof $<"u"&&(p&&($=encodeURIComponent(JSON.stringify($))),d.push(s+"="+$))}function y(s){if(typeof s<"u"){var l=Number(s);return!isNaN(l)&&l===parseInt(s,10)?l:s}}function x(s){return s.group_level=y(s.group_level),s.limit=y(s.limit),s.skip=y(s.skip),s}function j(s){if(s){if(typeof s!="number")return new se('Invalid value for integer: "'+s+'"');if(s<0)return new se('Invalid value for positive integer: "'+s+'"')}}function b(s,l){var d=s.descending?"endkey":"startkey",p=s.descending?"startkey":"endkey";if(typeof s[d]<"u"&&typeof s[p]<"u"&&U(s[d],s[p])>0)throw new se("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(l.reduce&&s.reduce!==!1){if(s.include_docs)throw new se("{include_docs:true} is invalid for reduce");if(s.keys&&s.keys.length>1&&!s.group&&!s.group_level)throw new se("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function($){var E=j(s[$]);if(E)throw E})}function A(s,l,d){var p=[],$,E="GET",v,_;if(h("reduce",d,p),h("include_docs",d,p),h("attachments",d,p),h("limit",d,p),h("descending",d,p),h("group",d,p),h("group_level",d,p),h("skip",d,p),h("stale",d,p),h("conflicts",d,p),h("startkey",d,p,!0),h("start_key",d,p,!0),h("endkey",d,p,!0),h("end_key",d,p,!0),h("inclusive_end",d,p),h("key",d,p,!0),h("update_seq",d,p),p=p.join("&"),p=p===""?"":"?"+p,typeof d.keys<"u"){var w=2e3,k="keys="+encodeURIComponent(JSON.stringify(d.keys));k.length+p.length+1<=w?p+=(p[0]==="?"?"&":"?")+k:(E="POST",typeof l=="string"?$={keys:d.keys}:l.keys=d.keys)}if(typeof l=="string"){var I=wn(l);return s.fetch("_design/"+I[0]+"/_view/"+I[1]+p,{headers:new Ve({"Content-Type":"application/json"}),method:E,body:JSON.stringify($)}).then(function(m){return v=m.ok,_=m.status,m.json()}).then(function(m){if(!v)throw m.status=_,An(m);return m.rows.forEach(function(R){if(R.value&&R.value.error&&R.value.error==="builtin_reduce_error")throw new Error(R.reason)}),m}).then(g(d))}return $=$||{},Object.keys(l).forEach(function(m){Array.isArray(l[m])?$[m]=l[m]:$[m]=l[m].toString()}),s.fetch("_temp_view"+p,{headers:new Ve({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify($)}).then(function(m){return v=m.ok,_=m.status,m.json()}).then(function(m){if(!v)throw m.status=_,An(m);return m}).then(g(d))}function O(s,l,d){return new Promise(function(p,$){s._query(l,d,function(E,v){if(E)return $(E);p(v)})})}function B(s){return new Promise(function(l,d){s._viewCleanup(function(p,$){if(p)return d(p);l($)})})}function L(s){return function(l){if(l.status===404)return s;throw l}}function V(s,l,d){var p="_local/doc_"+s,$={_id:p,keys:[]},E=d.get(s),v=E[0],_=E[1];function w(){return fi(_)?Promise.resolve($):l.db.get(p).catch(L($))}function k(m){return m.keys.length?l.db.allDocs({keys:m.keys,include_docs:!0}):Promise.resolve({rows:[]})}function I(m,R){for(var Q=[],Y=new Ce,F=0,S=R.rows.length;F<S;F++){var P=R.rows[F],N=P.doc;if(N&&(Q.push(N),Y.add(N._id),N._deleted=!v.has(N._id),!N._deleted)){var M=v.get(N._id);"value"in M&&(N.value=M.value)}}var z=$n(v);return z.forEach(function(ne){if(!Y.has(ne)){var xe={_id:ne},cr=v.get(ne);"value"in cr&&(xe.value=cr.value),Q.push(xe)}}),m.keys=vr(z.concat(m.keys)),Q.push(m),Q}return w().then(function(m){return k(m).then(function(R){return I(m,R)})})}function H(s,l,d){var p="_local/lastSeq";return s.db.get(p).catch(L({_id:p,seq:0})).then(function($){var E=$n(l);return Promise.all(E.map(function(v){return V(v,s,l)})).then(function(v){var _=dr(v);return $.seq=d,_.push($),s.db.bulkDocs({docs:_})})})}function X(s){var l=typeof s=="string"?s:s.name,d=pr[l];return d||(d=pr[l]=new Te),d}function ee(s,l){return _n(X(s),function(){return G(s,l)})()}function G(s,l){var d,p;function $(F,S){var P={id:p._id,key:de(F)};typeof S<"u"&&S!==null&&(P.value=de(S)),d.push(P)}var E=n(s.mapFun,$),v=s.seq||0;function _(F,S){return function(){return H(s,F,S)}}let w=0,k={view:s.name,indexed_docs:w};s.sourceDB.emit("indexing",k);var I=new Te;function m(){return s.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:v,limit:l.changes_batch_size}).then(R)}function R(F){var S=F.results;if(!S.length)return;var P=Q(S);I.add(_(P,v)),w=w+S.length;let N={view:s.name,last_seq:F.last_seq,results_count:S.length,indexed_docs:w};if(s.sourceDB.emit("indexing",N),!(S.length<l.changes_batch_size))return m()}function Q(F){for(var S=new me,P=0,N=F.length;P<N;P++){var M=F[P];if(M.doc._id[0]!=="_"){d=[],p=M.doc,p._deleted||i(s.sourceDB,E,p),d.sort(o);var z=Y(d);S.set(M.doc._id,[z,M.changes])}v=M.seq}return S}function Y(F){for(var S=new me,P,N=0,M=F.length;N<M;N++){var z=F[N],ne=[z.key,z.id];N>0&&U(z.key,P)===0&&ne.push(N),S.set(K(ne),z),P=z.key}return S}return m().then(function(){return I.finish()}).then(function(){s.seq=v})}function pe(s,l,d){d.group_level===0&&delete d.group_level;var p=d.group||d.group_level,$=r(s.reduceFun),E=[],v=isNaN(d.group_level)?Number.POSITIVE_INFINITY:d.group_level;l.forEach(function(m){var R=E[E.length-1],Q=p?m.key:null;if(p&&Array.isArray(Q)&&(Q=Q.slice(0,v)),R&&U(R.groupKey,Q)===0){R.keys.push([m.key,m.id]),R.values.push(m.value);return}E.push({keys:[[m.key,m.id]],values:[m.value],groupKey:Q})}),l=[];for(var _=0,w=E.length;_<w;_++){var k=E[_],I=a(s.sourceDB,$,k.keys,k.values,!1);if(I.error&&I.error instanceof Hn)throw I.error;l.push({value:I.error?null:I.output,key:k.groupKey})}return{rows:u(l,d.limit,d.skip)}}function ge(s,l){return _n(X(s),function(){return We(s,l)})()}function We(s,l){var d,p=s.reduceFun&&l.reduce!==!1,$=l.skip||0;typeof l.keys<"u"&&!l.keys.length&&(l.limit=0,delete l.keys);function E(F){return F.include_docs=!0,s.db.allDocs(F).then(function(S){return d=S.total_rows,S.rows.map(function(P){if("value"in P.doc&&typeof P.doc.value=="object"&&P.doc.value!==null){var N=Object.keys(P.doc.value).sort(),M=["id","key","value"];if(!(N<M||N>M))return P.doc.value}var z=qt(P.doc._id);return{key:z[0],id:z[1],value:"value"in P.doc?P.doc.value:null}})})}function v(F){var S;if(p?S=pe(s,F,l):typeof l.keys>"u"?S={total_rows:d,offset:$,rows:F}:S={total_rows:d,offset:$,rows:u(F,l.limit,l.skip)},l.update_seq&&(S.update_seq=s.seq),l.include_docs){var P=vr(F.map(f));return s.sourceDB.allDocs({keys:P,include_docs:!0,conflicts:l.conflicts,attachments:l.attachments,binary:l.binary}).then(function(N){var M=new me;return N.rows.forEach(function(z){M.set(z.id,z.doc)}),F.forEach(function(z){var ne=f(z),xe=M.get(ne);xe&&(z.doc=xe)}),S})}else return S}if(typeof l.keys<"u"){var _=l.keys,w=_.map(function(F){var S={startkey:K([F]),endkey:K([F,{}])};return l.update_seq&&(S.update_seq=!0),E(S)});return Promise.all(w).then(dr).then(v)}else{var k={descending:l.descending};l.update_seq&&(k.update_seq=!0);var I,m;if("start_key"in l&&(I=l.start_key),"startkey"in l&&(I=l.startkey),"end_key"in l&&(m=l.end_key),"endkey"in l&&(m=l.endkey),typeof I<"u"&&(k.startkey=l.descending?K([I,{}]):K([I])),typeof m<"u"){var R=l.inclusive_end!==!1;l.descending&&(R=!R),k.endkey=K(R?[m,{}]:[m])}if(typeof l.key<"u"){var Q=K([l.key]),Y=K([l.key,{}]);k.descending?(k.endkey=Q,k.startkey=Y):(k.startkey=Q,k.endkey=Y)}return p||(typeof l.limit=="number"&&(k.limit=l.limit),k.skip=$),E(k).then(v)}}function yn(s){return s.fetch("_view_cleanup",{headers:new Ve({"Content-Type":"application/json"}),method:"POST"}).then(function(l){return l.json()})}function pn(s){return s.get("_local/"+e).then(function(l){var d=new me;Object.keys(l.views).forEach(function($){var E=wn($),v="_design/"+E[0],_=E[1],w=d.get(v);w||(w=new Ce,d.set(v,w)),w.add(_)});var p={keys:$n(d),include_docs:!0};return s.allDocs(p).then(function($){var E={};$.rows.forEach(function(w){var k=w.key.substring(8);d.get(w.key).forEach(function(I){var m=k+"/"+I;l.views[m]||(m=I);var R=Object.keys(l.views[m]),Q=w.doc&&w.doc.views&&w.doc.views[I];R.forEach(function(Y){E[Y]=E[Y]||Q})})});var v=Object.keys(E).filter(function(w){return!E[w]}),_=v.map(function(w){return _n(X(w),function(){return new s.constructor(w,s.__opts).destroy()})()});return Promise.all(_).then(function(){return{ok:!0}})})},L({ok:!0}))}function He(s,l,d){if(typeof s._query=="function")return O(s,l,d);if(ve(s))return A(s,l,d);var p={changes_batch_size:s.__opts.view_update_changes_batch_size||ui};if(typeof l!="string")return b(d,l),gr.add(function(){var w=yr(s,"temp_view/temp_view",l.map,l.reduce,!0,e);return w.then(function(k){return ai(ee(k,p).then(function(){return ge(k,d)}),function(){return k.db.destroy()})})}),gr.finish();var $=l,E=wn($),v=E[0],_=E[1];return s.get("_design/"+v).then(function(w){var k=w.views&&w.views[_];if(!k)throw new Wn("ddoc "+w._id+" has no view named "+_);t(w,_),b(d,k);var I=yr(s,$,k.map,k.reduce,!1,e);return I.then(function(m){return d.stale==="ok"||d.stale==="update_after"?(d.stale==="update_after"&&_e(function(){ee(m,p)}),ge(m,d)):ee(m,p).then(function(){return ge(m,d)})})})}function gn(s,l,d){var p=this;typeof l=="function"&&(d=l,l={}),l=l?x(l):{},typeof s=="function"&&(s={map:s});var $=Promise.resolve().then(function(){return He(p,s,l)});return Jr($,d),$}var mn=ii(function(){var s=this;return typeof s._viewCleanup=="function"?B(s):ve(s)?yn(s):pn(s)});return{query:gn,viewCleanup:mn}}function Ue(e,n){for(var r=e,t=0,i=n.length;t<i;t++){var a=n[t];if(r=r[a],!r)break}return r}function qr(e,n,r){for(var t=0,i=n.length;t<i-1;t++){var a=n[t];e=e[a]=e[a]||{}}e[n[i-1]]=r}function cn(e,n){return e<n?-1:e>n?1:0}function he(e){for(var n=[],r="",t=0,i=e.length;t<i;t++){var a=e[t];t>0&&e[t-1]==="\\"&&(a==="$"||a===".")?r=r.substring(0,r.length-1)+a:a==="."?(n.push(r),r=""):r+=a}return n.push(r),n}var ci=["$or","$nor","$not"];function Xn(e){return ci.indexOf(e)>-1}function q(e){return Object.keys(e)[0]}function ln(e){return e[q(e)]}function Pe(e){var n={},r={$or:!0,$nor:!0};return e.forEach(function(t){Object.keys(t).forEach(function(i){var a=t[i];if(typeof a!="object"&&(a={$eq:a}),Xn(i))if(a instanceof Array){if(r[i]){r[i]=!1,n[i]=a;return}var o=[];n[i].forEach(function(f){Object.keys(a).forEach(function(c){var g=a[c],h=Math.max(Object.keys(f).length,Object.keys(g).length),y=Pe([f,g]);Object.keys(y).length<=h||o.push(y)})}),n[i]=o}else n[i]=Pe([a]);else{var u=n[i]=n[i]||{};Object.keys(a).forEach(function(f){var c=a[f];if(f==="$gt"||f==="$gte")return li(f,c,u);if(f==="$lt"||f==="$lte")return di(f,c,u);if(f==="$ne")return vi(c,u);if(f==="$eq")return hi(c,u);if(f==="$regex")return yi(c,u);u[f]=c})}})}),n}function li(e,n,r){typeof r.$eq<"u"||(typeof r.$gte<"u"?e==="$gte"?n>r.$gte&&(r.$gte=n):n>=r.$gte&&(delete r.$gte,r.$gt=n):typeof r.$gt<"u"?e==="$gte"?n>r.$gt&&(delete r.$gt,r.$gte=n):n>r.$gt&&(r.$gt=n):r[e]=n)}function di(e,n,r){typeof r.$eq<"u"||(typeof r.$lte<"u"?e==="$lte"?n<r.$lte&&(r.$lte=n):n<=r.$lte&&(delete r.$lte,r.$lt=n):typeof r.$lt<"u"?e==="$lte"?n<r.$lt&&(delete r.$lt,r.$lte=n):n<r.$lt&&(r.$lt=n):r[e]=n)}function vi(e,n){"$ne"in n?n.$ne.push(e):n.$ne=[e]}function hi(e,n){delete n.$gt,delete n.$gte,delete n.$lt,delete n.$lte,delete n.$ne,n.$eq=e}function yi(e,n){"$regex"in n?n.$regex.push(e):n.$regex=[e]}function Gr(e){for(var n in e){if(Array.isArray(e))for(var r in e)e[r].$and&&(e[r]=Pe(e[r].$and));var t=e[n];typeof t=="object"&&Gr(t)}return e}function Kr(e,n){for(var r in e){r==="$and"&&(n=!0);var t=e[r];typeof t=="object"&&(n=Kr(t,n))}return n}function Yn(e){var n=oe(e),r=!1;Kr(n,!1)&&(n=Gr(n),"$and"in n&&(n=Pe(n.$and)),r=!0),["$or","$nor"].forEach(function(u){u in n&&n[u].forEach(function(f){for(var c=Object.keys(f),g=0;g<c.length;g++){var h=c[g],y=f[h];(typeof y!="object"||y===null)&&(f[h]={$eq:y})}})}),"$not"in n&&(n.$not=Pe([n.$not]));for(var t=Object.keys(n),i=0;i<t.length;i++){var a=t[i],o=n[a];typeof o!="object"||o===null?o={$eq:o}:r||("$ne"in o&&(o.$ne=[o.$ne]),"$regex"in o&&(o.$regex=[o.$regex])),n[a]=o}return n}function Wr(e){function n(r){return e.map(function(t){var i=q(t),a=he(i),o=Ue(r,a);return o})}return function(r,t){var i=n(r.doc),a=n(t.doc),o=U(i,a);return o!==0?o:cn(r.doc._id,t.doc._id)}}function Zn(e,n,r){if(e=e.filter(function(o){return ce(o.doc,n.selector,r)}),n.sort){var t=Wr(n.sort);e=e.sort(t),typeof n.sort[0]!="string"&&ln(n.sort[0])==="desc"&&(e=e.reverse())}if("limit"in n||"skip"in n){var i=n.skip||0,a=("limit"in n?n.limit:e.length)+i;e=e.slice(i,a)}return e}function ce(e,n,r){return r.every(function(t){var i=n[t],a=he(t),o=Ue(e,a);return Xn(t)?pi(t,i,e):nn(i,e,a,o)})}function nn(e,n,r,t){return e?typeof e=="object"?Object.keys(e).every(function(i){var a=e[i];if(i.indexOf("$")===0)return _r(i,n,a,r,t);var o=he(i);if(t===void 0&&typeof a!="object"&&o.length>0)return!1;var u=Ue(t,o);return typeof a=="object"?nn(a,n,r,u):_r("$eq",n,a,o,u)}):e===t:!0}function pi(e,n,r){return e==="$or"?n.some(function(t){return ce(r,t,Object.keys(t))}):e==="$not"?!ce(r,n,Object.keys(n)):!n.find(function(t){return ce(r,t,Object.keys(t))})}function _r(e,n,r,t,i){if(!wr[e])throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return wr[e](n,r,t,i)}function Ee(e){return typeof e<"u"&&e!==null}function ue(e){return typeof e<"u"}function gi(e,n){if(typeof e!="number"||parseInt(e,10)!==e)return!1;var r=n[0],t=n[1];return e%r===t}function $r(e,n){return n.some(function(r){return e instanceof Array?e.some(function(t){return U(r,t)===0}):U(r,e)===0})}function mi(e,n){return n.every(function(r){return e.some(function(t){return U(r,t)===0})})}function _i(e,n){return e.length===n}function $i(e,n){var r=new RegExp(n);return r.test(e)}function wi(e,n){switch(n){case"null":return e===null;case"boolean":return typeof e=="boolean";case"number":return typeof e=="number";case"string":return typeof e=="string";case"array":return e instanceof Array;case"object":return{}.toString.call(e)==="[object Object]"}}var wr={$elemMatch:function(e,n,r,t){return!Array.isArray(t)||t.length===0?!1:typeof t[0]=="object"&&t[0]!==null?t.some(function(i){return ce(i,n,Object.keys(n))}):t.some(function(i){return nn(n,e,r,i)})},$allMatch:function(e,n,r,t){return!Array.isArray(t)||t.length===0?!1:typeof t[0]=="object"&&t[0]!==null?t.every(function(i){return ce(i,n,Object.keys(n))}):t.every(function(i){return nn(n,e,r,i)})},$eq:function(e,n,r,t){return ue(t)&&U(t,n)===0},$gte:function(e,n,r,t){return ue(t)&&U(t,n)>=0},$gt:function(e,n,r,t){return ue(t)&&U(t,n)>0},$lte:function(e,n,r,t){return ue(t)&&U(t,n)<=0},$lt:function(e,n,r,t){return ue(t)&&U(t,n)<0},$exists:function(e,n,r,t){return n?ue(t):!ue(t)},$mod:function(e,n,r,t){return Ee(t)&&gi(t,n)},$ne:function(e,n,r,t){return n.every(function(i){return U(t,i)!==0})},$in:function(e,n,r,t){return Ee(t)&&$r(t,n)},$nin:function(e,n,r,t){return Ee(t)&&!$r(t,n)},$size:function(e,n,r,t){return Ee(t)&&Array.isArray(t)&&_i(t,n)},$all:function(e,n,r,t){return Array.isArray(t)&&mi(t,n)},$regex:function(e,n,r,t){return Ee(t)&&typeof t=="string"&&n.every(function(i){return $i(t,i)})},$type:function(e,n,r,t){return wi(t,n)}};function ze(e,n){if(typeof n!="object")throw new Error("Selector error: expected a JSON object");n=Yn(n);var r={doc:e},t=Zn([r],{selector:n},Object.keys(n));return t&&t.length===1}const bi=Object.freeze(Object.defineProperty({__proto__:null,compare:cn,createFieldSorter:Wr,filterInMemoryFields:Zn,getFieldFromDoc:Ue,getKey:q,getValue:ln,isCombinationalField:Xn,massageSelector:Yn,matchesSelector:ze,parseField:he,rowFilter:ce,setFieldInDoc:qr},Symbol.toStringTag,{value:"Module"}));function Hr(e){return e=oe(e),e.index||(e.index={}),["type","name","ddoc"].forEach(function(n){e.index[n]&&(e[n]=e.index[n],delete e.index[n])}),e.fields&&(e.index.fields=e.fields,delete e.fields),e.type||(e.type="json"),e}function ki(e,n,r){var t="",i=n,a=!0;if(["$in","$nin","$or","$and","$mod","$nor","$all"].indexOf(e)!==-1&&(Array.isArray(n)||(t="Query operator "+e+" must be an array.")),["$not","$elemMatch","$allMatch"].indexOf(e)!==-1&&(!Array.isArray(n)&&typeof n=="object"&&n!==null||(t="Query operator "+e+" must be an object.")),e==="$mod"&&Array.isArray(n))if(n.length!==2)t="Query operator $mod must be in the format [divisor, remainder], where divisor and remainder are both integers.";else{var o=n[0],u=n[1];o===0&&(t="Query operator $mod's divisor cannot be 0, cannot divide by zero.",a=!1),(typeof o!="number"||parseInt(o,10)!==o)&&(t="Query operator $mod's divisor is not an integer.",i=o),parseInt(u,10)!==u&&(t="Query operator $mod's remainder is not an integer.",i=u)}if(e==="$exists"&&typeof n!="boolean"&&(t="Query operator $exists must be a boolean."),e==="$type"){var f=["null","boolean","number","string","array","object"],c='"'+f.slice(0,f.length-1).join('", "')+'", or "'+f[f.length-1]+'"';(typeof n!="string"||f.indexOf(n)==-1)&&(t="Query operator $type must be a string. Supported values: "+c+".")}if(e==="$size"&&parseInt(n,10)!==n&&(t="Query operator $size must be a integer."),e==="$regex"&&typeof n!="string"&&(console.log("here",r),r?t="Query operator $regex must be a string.":n instanceof RegExp||(t="Query operator $regex must be a string or an instance of a javascript regular expression.")),t){if(a){var g=i===null?" ":Array.isArray(i)?" array":" "+typeof i,h=typeof i=="object"&&i!==null?JSON.stringify(i,null,"	"):i;t+=" Received"+g+": "+h}throw new Error(t)}}var xi=["$all","$allMatch","$and","$elemMatch","$exists","$in","$mod","$nin","$nor","$not","$or","$regex","$size","$type"],Oi=["$in","$nin","$mod","$all"],Ei=["$eq","$gt","$gte","$lt","$lte"];function rn(e,n){if(Array.isArray(e))for(var r of e)typeof r=="object"&&o!==null&&rn(r,n);else for(var t=Object.keys(e),i=0;i<t.length;i++){var a=t[i],o=e[a];xi.indexOf(a)!==-1&&ki(a,o,n),Ei.indexOf(a)===-1&&Oi.indexOf(a)===-1&&typeof o=="object"&&o!==null&&rn(o,n)}}function Qe(e,n,r,t){var i,a;r.headers=new Ve({"Content-type":"application/json"}),e.fetch(n,r).then(function(o){return i=o.status,a=o.ok,o.json()}).then(function(o){if(a)t(null,o);else{o.status=i;var u=An(o);t(u)}}).catch(t)}function Ai(e,n,r){n=Hr(n),Qe(e,"_index",{method:"POST",body:JSON.stringify(n)},r)}function Si(e,n,r){rn(n.selector,!0),Qe(e,"_find",{method:"POST",body:JSON.stringify(n)},r)}function Ii(e,n,r){Qe(e,"_explain",{method:"POST",body:JSON.stringify(n)},r)}function ji(e,n){Qe(e,"_index",{method:"GET"},n)}function Fi(e,n,r){var t=n.ddoc,i=n.type||"json",a=n.name;if(!t)return r(new Error("you must provide an index's ddoc"));if(!a)return r(new Error("you must provide an index's name"));var o="_index/"+[t,i,a].map(encodeURIComponent).join("/");Qe(e,o,{method:"DELETE"},r)}function Xr(e){return function(){for(var n=arguments.length,r=new Array(n),t=-1;++t<n;)r[t]=arguments[t];return e.call(this,r)}}function Me(e){return Xr(function(n){var r=n.pop(),t=e.apply(this,n);return Ci(t,r),t})}function Ci(e,n){return e.then(function(r){_e(function(){n(null,r)})},function(r){_e(function(){n(r)})}),e}var Vn=Xr(function(e){for(var n=[],r=0,t=e.length;r<t;r++){var i=e[r];Array.isArray(i)?n=n.concat(Vn.apply(null,i)):n.push(i)}return n});function Dn(e){for(var n={},r=0,t=e.length;r<t;r++)n=Kn(n,e[r]);return n}function Ti(e,n){for(var r={},t=0,i=n.length;t<i;t++){var a=he(n[t]),o=Ue(e,a);typeof o<"u"&&qr(r,a,o)}return r}function Yr(e,n){for(var r=0,t=Math.min(e.length,n.length);r<t;r++)if(e[r]!==n[r])return!1;return!0}function Pi(e,n){return e.length>n.length?!1:Yr(e,n)}function Li(e,n){e=e.slice();for(var r=0,t=n.length;r<t;r++){var i=n[r];if(!e.length)break;var a=e.indexOf(i);if(a===-1)return!1;e.splice(a,1)}return!0}function Ni(e){for(var n={},r=0,t=e.length;r<t;r++)n[e[r]]=!0;return n}function Bi(e,n){for(var r=null,t=-1,i=0,a=e.length;i<a;i++){var o=e[i],u=n(o);u>t&&(t=u,r=o)}return r}function br(e,n){if(e.length!==n.length)return!1;for(var r=0,t=e.length;r<t;r++)if(e[r]!==n[r])return!1;return!0}function Ri(e){for(var n={},r=0;r<e.length;r++)n["$"+e[r]]=!0;return Object.keys(n).map(function(t){return t.substring(1)})}function Ui(e,n,r){return function(t){if(!(r&&!ze(t,r))){for(var i=[],a=0,o=e.length;a<o;a++){for(var u=he(e[a]),f=t,c=0,g=u.length;c<g;c++){var h=u[c];if(f=f[h],typeof f>"u")return}i.push(f)}n(i)}}}function zi(e,n,r){var t=he(e);return function(i){if(!(r&&!ze(i,r))){for(var a=i,o=0,u=t.length;o<u;o++){var f=t[o];if(a=a[f],typeof a>"u")return}n(a)}}}function Qi(e,n,r){return function(t){r&&!ze(t,r)||n(t[e])}}function Mi(e,n,r){return function(t){if(!(r&&!ze(t,r))){for(var i=[],a=0,o=e.length;a<o;a++)i.push(t[e[a]]);n(i)}}}function Ji(e){for(var n=0,r=e.length;n<r;n++){var t=e[n];if(t.indexOf(".")!==-1)return!1}return!0}function qi(e,n,r){var t=Ji(e),i=e.length===1;return t?i?Qi(e[0],n,r):Mi(e,n,r):i?zi(e[0],n,r):Ui(e,n,r)}function Gi(e,n){const r=Object.keys(e.fields),t=e.partial_filter_selector;return qi(r,n,t)}function Ki(){throw new Error("reduce not supported")}function Wi(e,n){var r=e.views[n];if(!r.map||!r.map.fields)throw new Error("ddoc "+e._id+" with view "+n+" doesn't have map.fields defined. maybe it wasn't created by this plugin?")}var Hi=si("indexes",Gi,Ki,Wi);function er(e){return e._customFindAbstractMapper||Hi}function Xi(e){if(!Array.isArray(e))throw new Error("invalid sort json - should be an array");return e.map(function(n){if(typeof n=="string"){var r={};return r[n]="asc",r}else return n})}function Yi(e){var n=[];return typeof e=="string"?n.push(e):n=e,n.map(function(r){return r.replace("_design/","")})}function Zr(e){return e.fields=e.fields.map(function(n){if(typeof n=="string"){var r={};return r[n]="asc",r}return n}),e}function Zi(e,n){for(var r=[],t=0;t<n.def.fields.length;t++){var i=q(n.def.fields[t]);r.push(e[i])}return r}function Vi(e,n,r){for(var t=r.def.fields,i=0,a=e.length;i<a;i++){var o=e[i],u=Zi(o.doc,r);if(t.length===1)u=u[0];else for(;u.length>n.length;)u.pop();if(Math.abs(U(u,n))>0)break}return i>0?e.slice(i):e}function Di(e){var n=oe(e);return delete n.startkey,delete n.endkey,delete n.inclusive_start,delete n.inclusive_end,"endkey"in e&&(n.startkey=e.endkey),"startkey"in e&&(n.endkey=e.startkey),"inclusive_start"in e&&(n.inclusive_end=e.inclusive_start),"inclusive_end"in e&&(n.inclusive_start=e.inclusive_end),n}function ea(e){var n=e.fields.filter(function(r){return ln(r)==="asc"});if(n.length!==0&&n.length!==e.fields.length)throw new Error("unsupported mixed sorting")}function na(e,n){if(n.defaultUsed&&e.sort){var r=e.sort.filter(function(t){return Object.keys(t)[0]!=="_id"}).map(function(t){return Object.keys(t)[0]});if(r.length>0)throw new Error('Cannot sort on field(s) "'+r.join(",")+'" when using the default index')}n.defaultUsed}function ra(e){if(typeof e.selector!="object")throw new Error("you must provide a selector when you find()")}function ta(e,n){var r=Object.keys(e),t=n?n.map(q):[],i;return r.length>=t.length?i=r:i=t,t.length===0?{fields:i}:(i=i.sort(function(a,o){var u=t.indexOf(a);u===-1&&(u=Number.MAX_VALUE);var f=t.indexOf(o);return f===-1&&(f=Number.MAX_VALUE),u<f?-1:u>f?1:0}),{fields:i,sortOrder:n.map(q)})}function ia(e,n){n=Hr(n);var r=oe(n.index);n.index=Zr(n.index),ea(n.index);var t;function i(){return t||(t=zr(JSON.stringify(n)))}var a=n.name||"idx-"+i(),o=n.ddoc||"idx-"+i(),u="_design/"+o,f=!1,c=!1;function g(h){return h._rev&&h.language!=="query"&&(f=!0),h.language="query",h.views=h.views||{},c=!!h.views[a],c?!1:(h.views[a]={map:{fields:Dn(n.index.fields)},reduce:"_count",options:{def:r}},h)}return e.constructor.emit("debug",["find","creating index",u]),sn(e,u,g).then(function(){if(f)throw new Error('invalid language for ddoc with id "'+u+'" (should be "query")')}).then(function(){var h=o+"/"+a;return er(e).query.call(e,h,{limit:0,reduce:!1}).then(function(){return{id:u,name:a,result:c?"exists":"created"}})})}function Vr(e){return e.allDocs({startkey:"_design/",endkey:"_design/￿",include_docs:!0}).then(function(n){var r={indexes:[{ddoc:null,name:"_all_docs",type:"special",def:{fields:[{_id:"asc"}]}}]};return r.indexes=Vn(r.indexes,n.rows.filter(function(t){return t.doc.language==="query"}).map(function(t){var i=t.doc.views!==void 0?Object.keys(t.doc.views):[];return i.map(function(a){var o=t.doc.views[a];return{ddoc:t.id,name:a,type:"json",def:Zr(o.options.def)}})})),r.indexes.sort(function(t,i){return cn(t.name,i.name)}),r.total_rows=r.indexes.length,r})}var tn=null,Pn={"￿":{}};const aa={queryOpts:{limit:0,startkey:Pn,endkey:tn},inMemoryFields:[]};function oa(e,n){for(var r=e.def.fields.map(q),t=0,i=r.length;t<i;t++){var a=r[t];if(n===a)return!0}return!1}function ua(e,n){var r=e[n],t=q(r);return t!=="$eq"}function Dr(e,n){var r=n.def.fields.map(q);return e.slice().sort(function(t,i){var a=r.indexOf(t),o=r.indexOf(i);return a===-1&&(a=Number.MAX_VALUE),o===-1&&(o=Number.MAX_VALUE),cn(a,o)})}function fa(e,n,r){r=Dr(r,e);for(var t=!1,i=0,a=r.length;i<a;i++){var o=r[i];if(t||!oa(e,o))return r.slice(i);i<a-1&&ua(n,o)&&(t=!0)}return[]}function sa(e){var n=[];return Object.keys(e).forEach(function(r){var t=e[r];Object.keys(t).forEach(function(i){i==="$ne"&&n.push(r)})}),n}function ca(e,n,r,t){var i=Vn(e,fa(n,r,t),sa(r));return Dr(Ri(i),n)}function la(e,n,r){if(n){var t=Pi(n,e),i=Yr(r,e);return t&&i}return Li(r,e)}var da=["$eq","$gt","$gte","$lt","$lte"];function et(e){return da.indexOf(e)===-1}function va(e,n){var r=e[0],t=n[r];if(typeof t>"u")return!0;var i=Object.keys(t).length===1&&q(t)==="$ne";return!i}function ha(e,n,r,t){var i=e.def.fields.map(q),a=la(i,n,r);return a?va(i,t):!1}function ya(e,n,r,t){return t.filter(function(i){return ha(i,r,n,e)})}function pa(e,n,r,t,i){var a=ya(e,n,r,t);if(a.length===0){if(i)throw{error:"no_usable_index",message:"There is no index available for this selector."};var o=t[0];return o.defaultUsed=!0,o}if(a.length===1&&!i)return a[0];var u=Ni(n);function f(y){for(var x=y.def.fields.map(q),j=0,b=0,A=x.length;b<A;b++){var O=x[b];u[O]&&j++}return j}if(i){var c="_design/"+i[0],g=i.length===2?i[1]:!1,h=a.find(function(y){return!!(g&&y.ddoc===c&&g===y.name||y.ddoc===c)});if(!h)throw{error:"unknown_error",message:"Could not find that index or could not use that index for the query"};return h}return Bi(a,f)}function ga(e,n){switch(e){case"$eq":return{key:n};case"$lte":return{endkey:n};case"$gte":return{startkey:n};case"$lt":return{endkey:n,inclusive_end:!1};case"$gt":return{startkey:n,inclusive_start:!1}}return{startkey:tn}}function ma(e,n){var r=q(n.def.fields[0]),t=e[r]||{},i=[],a=Object.keys(t),o;return a.forEach(function(u){et(u)&&i.push(r);var f=t[u],c=ga(u,f);o?o=Dn([o,c]):o=c}),{queryOpts:o,inMemoryFields:i}}function _a(e,n){switch(e){case"$eq":return{startkey:n,endkey:n};case"$lte":return{endkey:n};case"$gte":return{startkey:n};case"$lt":return{endkey:n,inclusive_end:!1};case"$gt":return{startkey:n,inclusive_start:!1}}}function $a(e,n){var r=n.def.fields.map(q),t=[],i=[],a=[],o,u;function f(pe){o!==!1&&i.push(tn),u!==!1&&a.push(Pn),t=r.slice(pe)}for(var c=0,g=r.length;c<g;c++){var h=r[c],y=e[h];if(!y||!Object.keys(y).length){f(c);break}else if(Object.keys(y).some(et)){f(c);break}else if(c>0){var x="$gt"in y||"$gte"in y||"$lt"in y||"$lte"in y,j=Object.keys(e[r[c-1]]),b=br(j,["$eq"]),A=br(j,Object.keys(y)),O=x&&!b&&!A;if(O){f(c);break}}for(var B=Object.keys(y),L=null,V=0;V<B.length;V++){var H=B[V],X=y[H],ee=_a(H,X);L?L=Dn([L,ee]):L=ee}i.push("startkey"in L?L.startkey:tn),a.push("endkey"in L?L.endkey:Pn),"inclusive_start"in L&&(o=L.inclusive_start),"inclusive_end"in L&&(u=L.inclusive_end)}var G={startkey:i,endkey:a};return typeof o<"u"&&(G.inclusive_start=o),typeof u<"u"&&(G.inclusive_end=u),{queryOpts:G,inMemoryFields:t}}function wa(e){return Object.keys(e).map(function(r){return e[r]}).some(function(r){return typeof r=="object"&&Object.keys(r).length===0})}function ba(e){return{queryOpts:{startkey:null},inMemoryFields:[Object.keys(e)]}}function ka(e,n){return n.defaultUsed?ba(e):n.def.fields.length===1?ma(e,n):$a(e,n)}function xa(e,n){var r=e.selector,t=e.sort;if(wa(r))return Kn({},aa,{index:n[0]});var i=ta(r,t),a=i.fields,o=i.sortOrder,u=pa(r,a,o,n,e.use_index),f=ka(r,u),c=f.queryOpts,g=f.inMemoryFields,h=ca(g,u,r,a),y={queryOpts:c,index:u,inMemoryFields:h};return y}function Oa(e){return e.ddoc.substring(8)+"/"+e.name}function Ea(e,n){var r=oe(n);return r.descending?("endkey"in r&&typeof r.endkey!="string"&&(r.endkey=""),"startkey"in r&&typeof r.startkey!="string"&&(r.limit=0)):("startkey"in r&&typeof r.startkey!="string"&&(r.startkey=""),"endkey"in r&&typeof r.endkey!="string"&&(r.limit=0)),"key"in r&&typeof r.key!="string"&&(r.limit=0),r.limit>0&&r.indexes_count&&(r.original_limit=r.limit,r.limit+=r.indexes_count),e.allDocs(r).then(function(t){return t.rows=t.rows.filter(function(i){return!/^_design\//.test(i.id)}),r.original_limit&&(r.limit=r.original_limit),t.rows=t.rows.slice(0,r.limit),t})}function nt(e,n,r){return n.selector&&(rn(n.selector,!1),n.selector=Yn(n.selector)),n.sort&&(n.sort=Xi(n.sort)),n.use_index&&(n.use_index=Yi(n.use_index)),ra(n),Vr(e).then(function(t){e.constructor.emit("debug",["find","planning query",n]);var i=xa(n,t.indexes);e.constructor.emit("debug",["find","query plan",i]);var a=i.index;na(n,a);var o=Kn({include_docs:!0,reduce:!1,indexes_count:t.total_rows},i.queryOpts);if("startkey"in o&&"endkey"in o&&U(o.startkey,o.endkey)>0)return{docs:[]};var u=n.sort&&typeof n.sort[0]!="string"&&ln(n.sort[0])==="desc";return u&&(o.descending=!0,o=Di(o)),i.inMemoryFields.length||("limit"in n&&(o.limit=n.limit),"skip"in n&&(o.skip=n.skip)),r?Promise.resolve(i,o):Promise.resolve().then(function(){if(a.name==="_all_docs")return Ea(e,o);var f=Oa(a);return er(e).query.call(e,f,o)}).then(function(f){o.inclusive_start===!1&&(f.rows=Vi(f.rows,o.startkey,a)),i.inMemoryFields.length&&(f.rows=Zn(f.rows,n,i.inMemoryFields));var c={docs:f.rows.map(function(g){var h=g.doc;return n.fields?Ti(h,n.fields):h})};return a.defaultUsed&&(c.warning="No matching index found, create an index to optimize query time."),c})})}function Aa(e,n){return nt(e,n,!0).then(function(r){return{dbname:e.name,index:r.index,selector:n.selector,range:{start_key:r.queryOpts.startkey,end_key:r.queryOpts.endkey},opts:{use_index:n.use_index||[],bookmark:"nil",limit:n.limit,skip:n.skip,sort:n.sort||{},fields:n.fields,conflicts:!1,r:[49]},limit:n.limit,skip:n.skip||0,fields:n.fields}})}function Sa(e,n){if(!n.ddoc)throw new Error("you must supply an index.ddoc when deleting");if(!n.name)throw new Error("you must supply an index.name when deleting");var r=n.ddoc,t=n.name;function i(a){return Object.keys(a.views).length===1&&a.views[t]?{_id:r,_deleted:!0}:(delete a.views[t],a)}return sn(e,r,i).then(function(){return er(e).viewCleanup.apply(e)}).then(function(){return{ok:!0}})}var Ia=Me(ia),ja=Me(nt),Fa=Me(Aa),Ca=Me(Vr),Ta=Me(Sa),we={};we.createIndex=Be(function(e,n){if(typeof e!="object")return n(new Error("you must provide an index to create"));var r=ve(this)?Ai:Ia;r(this,e,n)});we.find=Be(function(e,n){if(typeof n>"u"&&(n=e,e=void 0),typeof e!="object")return n(new Error("you must provide search parameters to find()"));var r=ve(this)?Si:ja;r(this,e,n)});we.explain=Be(function(e,n){if(typeof n>"u"&&(n=e,e=void 0),typeof e!="object")return n(new Error("you must provide search parameters to explain()"));var r=ve(this)?Ii:Fa;r(this,e,n)});we.getIndexes=Be(function(e){var n=ve(this)?ji:Ca;n(this,e)});we.deleteIndex=Be(function(e,n){if(typeof e!="object")return n(new Error("you must provide an index to delete"));var r=ve(this)?Fi:Ta;r(this,e,n)});var rt={},nr={};function Pa(e,n,r){for(var t="",i=r-e.length;t.length<i;)t+=n;return t}function La(e,n,r){var t=Pa(e,n,r);return t+e}var tt=-324,Ln=3,Nn="";function W(e,n){if(e===n)return 0;e=$e(e),n=$e(n);var r=Bn(e),t=Bn(n);if(r-t!==0)return r-t;switch(typeof e){case"number":return e-n;case"boolean":return e<n?-1:1;case"string":return Qa(e,n)}return Array.isArray(e)?za(e,n):Ma(e,n)}function $e(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var n=e;if(Array.isArray(e)){var r=e.length;e=new Array(r);for(var t=0;t<r;t++)e[t]=$e(n[t])}else{if(e instanceof Date)return e.toJSON();if(e!==null){e={};for(var i in n)if(n.hasOwnProperty(i)){var a=n[i];typeof a<"u"&&(e[i]=$e(a))}}}}return e}function Na(e){if(e!==null)switch(typeof e){case"boolean":return e?1:0;case"number":return Ja(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var n=Array.isArray(e),r=n?e:Object.keys(e),t=-1,i=r.length,a="";if(n)for(;++t<i;)a+=De(r[t]);else for(;++t<i;){var o=r[t];a+=De(o)+De(e[o])}return a}return""}function De(e){var n="\0";return e=$e(e),Bn(e)+Nn+Na(e)+n}function Ba(e,n){var r=n,t,i=e[n]==="1";if(i)t=0,n++;else{var a=e[n]==="0";n++;var o="",u=e.substring(n,n+Ln),f=parseInt(u,10)+tt;for(a&&(f=-f),n+=Ln;;){var c=e[n];if(c==="\0")break;o+=c,n++}o=o.split("."),o.length===1?t=parseInt(o,10):t=parseFloat(o[0]+"."+o[1]),a&&(t=t-10),f!==0&&(t=parseFloat(t+"e"+f))}return{num:t,length:n-r}}function Ra(e,n){var r=e.pop();if(n.length){var t=n[n.length-1];r===t.element&&(n.pop(),t=n[n.length-1]);var i=t.element,a=t.index;if(Array.isArray(i))i.push(r);else if(a===e.length-2){var o=e.pop();i[o]=r}else e.push(r)}}function Ua(e){for(var n=[],r=[],t=0;;){var i=e[t++];if(i==="\0"){if(n.length===1)return n.pop();Ra(n,r);continue}switch(i){case"1":n.push(null);break;case"2":n.push(e[t]==="1"),t++;break;case"3":var a=Ba(e,t);n.push(a.num),t+=a.length;break;case"4":for(var o="";;){var u=e[t];if(u==="\0")break;o+=u,t++}o=o.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),n.push(o);break;case"5":var f={element:[],index:n.length};n.push(f.element),r.push(f);break;case"6":var c={element:{},index:n.length};n.push(c.element),r.push(c);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}}}function za(e,n){for(var r=Math.min(e.length,n.length),t=0;t<r;t++){var i=W(e[t],n[t]);if(i!==0)return i}return e.length===n.length?0:e.length>n.length?1:-1}function Qa(e,n){return e===n?0:e>n?1:-1}function Ma(e,n){for(var r=Object.keys(e),t=Object.keys(n),i=Math.min(r.length,t.length),a=0;a<i;a++){var o=W(r[a],t[a]);if(o!==0||(o=W(e[r[a]],n[t[a]]),o!==0))return o}return r.length===t.length?0:r.length>t.length?1:-1}function Bn(e){var n=["boolean","number","string","object"],r=n.indexOf(typeof e);if(~r)return e===null?1:Array.isArray(e)?5:r<3?r+2:r+3;if(Array.isArray(e))return 5}function Ja(e){if(e===0)return"1";var n=e.toExponential().split(/e\+?/),r=parseInt(n[1],10),t=e<0,i=t?"0":"2",a=(t?-r:r)-tt,o=La(a.toString(),"0",Ln);i+=Nn+o;var u=Math.abs(parseFloat(n[0]));t&&(u=10-u);var f=u.toFixed(20);return f=f.replace(/\.?0+$/,""),i+=Nn+f,i}const qa=Object.freeze(Object.defineProperty({__proto__:null,collate:W,normalizeKey:$e,parseIndexableString:Ua,toIndexableString:De},Symbol.toStringTag,{value:"Module"})),it=Nr(qa);var kr=Z.MutationObserver||Z.WebKitMutationObserver,Se;if(kr){var xr=0,Ga=new kr(Ye),Or=Z.document.createTextNode("");Ga.observe(Or,{characterData:!0}),Se=function(){Or.data=xr=++xr%2}}else if(!Z.setImmediate&&typeof Z.MessageChannel<"u"){var Er=new Z.MessageChannel;Er.port1.onmessage=Ye,Se=function(){Er.port2.postMessage(0)}}else"document"in Z&&"onreadystatechange"in Z.document.createElement("script")?Se=function(){var e=Z.document.createElement("script");e.onreadystatechange=function(){Ye(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},Z.document.documentElement.appendChild(e)}:Se=function(){setTimeout(Ye,0)};var Rn,Ie=[];function Ye(){Rn=!0;for(var e,n,r=Ie.length;r;){for(n=Ie,Ie=[],e=-1;++e<r;)n[e]();r=Ie.length}Rn=!1}var at=Ka;function Ka(e){Ie.push(e)===1&&!Rn&&Se()}const Wa=on(at);var Ha=at;function be(){}var J={},ot=["REJECTED"],Un=["FULFILLED"],ut=["PENDING"];function ke(e){if(typeof e!="function")throw new TypeError("resolver must be a function");this.state=ut,this.queue=[],this.outcome=void 0,e!==be&&ft(this,e)}ke.prototype.catch=function(e){return this.then(null,e)};ke.prototype.then=function(e,n){if(typeof e!="function"&&this.state===Un||typeof n!="function"&&this.state===ot)return this;var r=new this.constructor(be);if(this.state!==ut){var t=this.state===Un?e:n;rr(r,t,this.outcome)}else this.queue.push(new Je(r,e,n));return r};function Je(e,n,r){this.promise=e,typeof n=="function"&&(this.onFulfilled=n,this.callFulfilled=this.otherCallFulfilled),typeof r=="function"&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}Je.prototype.callFulfilled=function(e){J.resolve(this.promise,e)};Je.prototype.otherCallFulfilled=function(e){rr(this.promise,this.onFulfilled,e)};Je.prototype.callRejected=function(e){J.reject(this.promise,e)};Je.prototype.otherCallRejected=function(e){rr(this.promise,this.onRejected,e)};function rr(e,n,r){Ha(function(){var t;try{t=n(r)}catch(i){return J.reject(e,i)}t===e?J.reject(e,new TypeError("Cannot resolve promise with itself")):J.resolve(e,t)})}J.resolve=function(e,n){var r=st(Xa,n);if(r.status==="error")return J.reject(e,r.value);var t=r.value;if(t)ft(e,t);else{e.state=Un,e.outcome=n;for(var i=-1,a=e.queue.length;++i<a;)e.queue[i].callFulfilled(n)}return e};J.reject=function(e,n){e.state=ot,e.outcome=n;for(var r=-1,t=e.queue.length;++r<t;)e.queue[r].callRejected(n);return e};function Xa(e){var n=e&&e.then;if(e&&(typeof e=="object"||typeof e=="function")&&typeof n=="function")return function(){n.apply(e,arguments)}}function ft(e,n){var r=!1;function t(u){r||(r=!0,J.reject(e,u))}function i(u){r||(r=!0,J.resolve(e,u))}function a(){n(i,t)}var o=st(a);o.status==="error"&&t(o.value)}function st(e,n){var r={};try{r.value=e(n),r.status="success"}catch(t){r.status="error",r.value=t}return r}ke.resolve=Ya;function Ya(e){return e instanceof this?e:J.resolve(new this(be),e)}ke.reject=Za;function Za(e){var n=new this(be);return J.reject(n,e)}ke.all=Va;function Va(e){var n=this;if(Object.prototype.toString.call(e)!=="[object Array]")return this.reject(new TypeError("must be an array"));var r=e.length,t=!1;if(!r)return this.resolve([]);for(var i=new Array(r),a=0,o=-1,u=new this(be);++o<r;)f(e[o],o);return u;function f(c,g){n.resolve(c).then(h,function(y){t||(t=!0,J.reject(u,y))});function h(y){i[g]=y,++a===r&&!t&&(t=!0,J.resolve(u,i))}}}ke.race=Da;function Da(e){var n=this;if(Object.prototype.toString.call(e)!=="[object Array]")return this.reject(new TypeError("must be an array"));var r=e.length,t=!1;if(!r)return this.resolve([]);for(var i=-1,a=new this(be);++i<r;)o(e[i]);return a;function o(u){n.resolve(u).then(function(f){t||(t=!0,J.resolve(a,f))},function(f){t||(t=!0,J.reject(a,f))})}}function dn(e){return"$"+e}function eo(e){return e.substring(1)}function ye(){this._store={}}ye.prototype.get=function(e){var n=dn(e);return this._store[n]};ye.prototype.set=function(e,n){var r=dn(e);return this._store[r]=n,!0};ye.prototype.has=function(e){var n=dn(e);return n in this._store};ye.prototype.delete=function(e){var n=dn(e),r=n in this._store;return delete this._store[n],r};ye.prototype.forEach=function(e){for(var n=Object.keys(this._store),r=0,t=n.length;r<t;r++){var i=n[r],a=this._store[i];i=eo(i),e(a,i)}};Object.defineProperty(ye.prototype,"size",{get:function(){return Object.keys(this._store).length}});function vn(e){if(this._store=new ye,e&&Array.isArray(e))for(var n=0,r=e.length;n<r;n++)this.add(e[n])}vn.prototype.add=function(e){return this._store.set(e,!0)};vn.prototype.has=function(e){return this._store.has(e)};vn.prototype.forEach=function(e){this._store.forEach(function(n,r){e(r)})};Object.defineProperty(vn.prototype,"size",{get:function(){return this._store.size}});var zn={exports:{}};typeof Object.create=="function"?zn.exports=function(n,r){n.super_=r,n.prototype=Object.create(r.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}})}:zn.exports=function(n,r){n.super_=r;var t=function(){};t.prototype=r.prototype,n.prototype=new t,n.prototype.constructor=n};var no=zn.exports;const ct=on(no);ct(T,Error);function T(e,n,r){Error.call(this,r),this.status=e,this.name=n,this.message=r,this.error=!0}T.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};new T(401,"unauthorized","Name or password is incorrect.");new T(400,"bad_request","Missing JSON list of 'docs'");new T(404,"not_found","missing");new T(409,"conflict","Document update conflict");new T(400,"bad_request","_id field must contain a string");new T(412,"missing_id","_id is required for puts");new T(400,"bad_request","Only reserved document ids may start with underscore.");new T(412,"precondition_failed","Database not open");new T(500,"unknown_error","Database encountered an unknown error");new T(500,"badarg","Some query argument is invalid");new T(400,"invalid_request","Request was invalid");new T(400,"query_parse_error","Some query parameter is invalid");new T(500,"doc_validation","Bad special document member");new T(400,"bad_request","Something wrong with the request");new T(400,"bad_request","Document must be a JSON object");new T(404,"not_found","Database not found");new T(500,"indexed_db_went_bad","unknown");new T(500,"web_sql_went_bad","unknown");new T(500,"levelDB_went_went_bad","unknown");new T(403,"forbidden","Forbidden by design doc validate_doc_update function");new T(400,"bad_request","Invalid rev format");new T(412,"file_exists","The database could not be created, the file already exists.");new T(412,"missing_stub","A pre-existing attachment stub wasn't found");new T(413,"invalid_url","Provided URL is invalid");var Qn={exports:{}},Ar=typeof crypto<"u"&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&msCrypto.getRandomValues.bind(msCrypto);if(Ar){var Sr=new Uint8Array(16);Qn.exports=function(){return Ar(Sr),Sr}}else{var Ir=new Array(16);Qn.exports=function(){for(var n=0,r;n<16;n++)n&3||(r=Math.random()*4294967296),Ir[n]=r>>>((n&3)<<3)&255;return Ir}}var lt=Qn.exports,dt=[];for(var Ze=0;Ze<256;++Ze)dt[Ze]=(Ze+256).toString(16).substr(1);function ro(e,n){var r=n||0,t=dt;return t[e[r++]]+t[e[r++]]+t[e[r++]]+t[e[r++]]+"-"+t[e[r++]]+t[e[r++]]+"-"+t[e[r++]]+t[e[r++]]+"-"+t[e[r++]]+t[e[r++]]+"-"+t[e[r++]]+t[e[r++]]+t[e[r++]]+t[e[r++]]+t[e[r++]]+t[e[r++]]}var vt=ro,to=lt,io=vt,jr,bn,kn=0,xn=0;function ao(e,n,r){var t=n&&r||0,i=n||[];e=e||{};var a=e.node||jr,o=e.clockseq!==void 0?e.clockseq:bn;if(a==null||o==null){var u=to();a==null&&(a=jr=[u[0]|1,u[1],u[2],u[3],u[4],u[5]]),o==null&&(o=bn=(u[6]<<8|u[7])&16383)}var f=e.msecs!==void 0?e.msecs:new Date().getTime(),c=e.nsecs!==void 0?e.nsecs:xn+1,g=f-kn+(c-xn)/1e4;if(g<0&&e.clockseq===void 0&&(o=o+1&16383),(g<0||f>kn)&&e.nsecs===void 0&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");kn=f,xn=c,bn=o,f+=122192928e5;var h=((f&268435455)*1e4+c)%4294967296;i[t++]=h>>>24&255,i[t++]=h>>>16&255,i[t++]=h>>>8&255,i[t++]=h&255;var y=f/4294967296*1e4&268435455;i[t++]=y>>>8&255,i[t++]=y&255,i[t++]=y>>>24&15|16,i[t++]=y>>>16&255,i[t++]=o>>>8|128,i[t++]=o&255;for(var x=0;x<6;++x)i[t+x]=a[x];return n||io(i)}var oo=ao,uo=lt,fo=vt;function so(e,n,r){var t=n&&r||0;typeof e=="string"&&(n=e==="binary"?new Array(16):null,e=null),e=e||{};var i=e.random||(e.rng||uo)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,n)for(var a=0;a<16;++a)n[t+a]=i[a];return n||fo(i)}var co=so,lo=oo,ht=co,tr=ht;tr.v1=lo;tr.v4=ht;var vo=tr;const ho=on(vo);function yo(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer||typeof Blob<"u"&&e instanceof Blob}function po(e){if(typeof e.slice=="function")return e.slice(0);var n=new ArrayBuffer(e.byteLength),r=new Uint8Array(n),t=new Uint8Array(e);return r.set(t),n}function go(e){if(e instanceof ArrayBuffer)return po(e);var n=e.size,r=e.type;return typeof e.slice=="function"?e.slice(0,n,r):e.webkitSlice(0,n,r)}var yt=Function.prototype.toString,mo=yt.call(Object);function _o(e){var n=Object.getPrototypeOf(e);if(n===null)return!0;var r=n.constructor;return typeof r=="function"&&r instanceof r&&yt.call(r)==mo}function Mn(e){var n,r,t;if(!e||typeof e!="object")return e;if(Array.isArray(e)){for(n=[],r=0,t=e.length;r<t;r++)n[r]=Mn(e[r]);return n}if(e instanceof Date)return e.toISOString();if(yo(e))return go(e);if(!_o(e))return e;n={};for(r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var i=Mn(e[r]);typeof i<"u"&&(n[r]=i)}return n}function $o(e,n){for(var r={},t=0,i=n.length;t<i;t++){var a=n[t];a in e&&(r[a]=e[a])}return r}function ir(){return typeof chrome<"u"&&typeof chrome.storage<"u"&&typeof chrome.storage.local<"u"}var en;if(ir())en=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),en=!!localStorage.getItem("_pouch_check_localstorage")}catch{en=!1}function pt(){return en}ct(qe,un.EventEmitter);function wo(e){ir()?chrome.storage.onChanged.addListener(function(n){n.db_name!=null&&e.emit(n.dbName.newValue)}):pt()&&(typeof addEventListener<"u"?addEventListener("storage",function(n){e.emit(n.key)}):window.attachEvent("storage",function(n){e.emit(n.key)}))}function qe(){un.EventEmitter.call(this),this._listeners={},wo(this)}qe.prototype.addListener=function(e,n,r,t){if(this._listeners[n])return;var i=this,a=!1;function o(){if(!i._listeners[n])return;if(a){a="waiting";return}a=!0;var u=$o(t,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);function f(){a=!1}r.changes(u).on("change",function(c){c.seq>t.since&&!t.cancelled&&(t.since=c.seq,t.onChange(c))}).on("complete",function(){a==="waiting"&&Wa(o),a=!1}).on("error",f)}this._listeners[n]=o,this.on(e,o)};qe.prototype.removeListener=function(e,n){n in this._listeners&&(un.EventEmitter.prototype.removeListener.call(this,e,this._listeners[n]),delete this._listeners[n])};qe.prototype.notifyLocalWindows=function(e){ir()?chrome.storage.local.set({dbName:e}):pt()&&(localStorage[e]=localStorage[e]==="a"?"b":"a")};qe.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};ho.v4;function ar(e,n){for(var r=e,t=0,i=n.length;t<i;t++){var a=n[t];if(r=r[a],!r)break}return r}function bo(e,n,r){for(var t=0,i=n.length;t<i-1;t++){var a=n[t];e=e[a]={}}e[n[i-1]]=r}function gt(e,n){return e<n?-1:e>n?1:0}function or(e){for(var n=[],r="",t=0,i=e.length;t<i;t++){var a=e[t];a==="."?t>0&&e[t-1]==="\\"?r=r.substring(0,r.length-1)+".":(n.push(r),r=""):r+=a}return n.push(r),n}var ko=["$or","$nor","$not"];function ur(e){return ko.indexOf(e)>-1}function fr(e){return Object.keys(e)[0]}function mt(e){return e[fr(e)]}function an(e){var n={};return e.forEach(function(r){Object.keys(r).forEach(function(t){var i=r[t];if(typeof i!="object"&&(i={$eq:i}),ur(t))i instanceof Array?n[t]=i.map(function(o){return an([o])}):n[t]=an([i]);else{var a=n[t]=n[t]||{};Object.keys(i).forEach(function(o){var u=i[o];if(o==="$gt"||o==="$gte")return xo(o,u,a);if(o==="$lt"||o==="$lte")return Oo(o,u,a);if(o==="$ne")return Eo(u,a);if(o==="$eq")return Ao(u,a);a[o]=u})}})}),n}function xo(e,n,r){typeof r.$eq<"u"||(typeof r.$gte<"u"?e==="$gte"?n>r.$gte&&(r.$gte=n):n>=r.$gte&&(delete r.$gte,r.$gt=n):typeof r.$gt<"u"?e==="$gte"?n>r.$gt&&(delete r.$gt,r.$gte=n):n>r.$gt&&(r.$gt=n):r[e]=n)}function Oo(e,n,r){typeof r.$eq<"u"||(typeof r.$lte<"u"?e==="$lte"?n<r.$lte&&(r.$lte=n):n<=r.$lte&&(delete r.$lte,r.$lt=n):typeof r.$lt<"u"?e==="$lte"?n<r.$lt&&(delete r.$lt,r.$lte=n):n<r.$lt&&(r.$lt=n):r[e]=n)}function Eo(e,n){"$ne"in n?n.$ne.push(e):n.$ne=[e]}function Ao(e,n){delete n.$gt,delete n.$gte,delete n.$lt,delete n.$lte,delete n.$ne,n.$eq=e}function _t(e){var n=Mn(e),r=!1;"$and"in n&&(n=an(n.$and),r=!0),["$or","$nor"].forEach(function(u){u in n&&n[u].forEach(function(f){for(var c=Object.keys(f),g=0;g<c.length;g++){var h=c[g],y=f[h];(typeof y!="object"||y===null)&&(f[h]={$eq:y})}})}),"$not"in n&&(n.$not=an([n.$not]));for(var t=Object.keys(n),i=0;i<t.length;i++){var a=t[i],o=n[a];typeof o!="object"||o===null?o={$eq:o}:"$ne"in o&&!r&&(o.$ne=[o.$ne]),n[a]=o}return n}function $t(e){function n(r){return e.map(function(t){var i=fr(t),a=or(i),o=ar(r,a);return o})}return function(r,t){var i=n(r.doc),a=n(t.doc),o=W(i,a);return o!==0?o:gt(r.doc._id,t.doc._id)}}function wt(e,n,r){if(e=e.filter(function(o){return le(o.doc,n.selector,r)}),n.sort){var t=$t(n.sort);e=e.sort(t),typeof n.sort[0]!="string"&&mt(n.sort[0])==="desc"&&(e=e.reverse())}if("limit"in n||"skip"in n){var i=n.skip||0,a=("limit"in n?n.limit:e.length)+i;e=e.slice(i,a)}return e}function le(e,n,r){return r.every(function(t){var i=n[t],a=or(t),o=ar(e,a);return ur(t)?So(t,i,e):Jn(i,e,a,o)})}function Jn(e,n,r,t){return e?Object.keys(e).every(function(i){var a=e[i];return Io(i,n,a,r,t)}):!0}function So(e,n,r){return e==="$or"?n.some(function(t){return le(r,t,Object.keys(t))}):e==="$not"?!le(r,n,Object.keys(n)):!n.find(function(t){return le(r,t,Object.keys(t))})}function Io(e,n,r,t,i){if(!Cr[e])throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return Cr[e](n,r,t,i)}function Ae(e){return typeof e<"u"&&e!==null}function fe(e){return typeof e<"u"}function jo(e,n){var r=n[0],t=n[1];if(r===0)throw new Error("Bad divisor, cannot divide by zero");if(parseInt(r,10)!==r)throw new Error("Divisor is not an integer");if(parseInt(t,10)!==t)throw new Error("Modulus is not an integer");return parseInt(e,10)!==e?!1:e%r===t}function Fr(e,n){return n.some(function(r){return e instanceof Array?e.indexOf(r)>-1:e===r})}function Fo(e,n){return n.every(function(r){return e.indexOf(r)>-1})}function Co(e,n){return e.length===n}function To(e,n){var r=new RegExp(n);return r.test(e)}function Po(e,n){switch(n){case"null":return e===null;case"boolean":return typeof e=="boolean";case"number":return typeof e=="number";case"string":return typeof e=="string";case"array":return e instanceof Array;case"object":return{}.toString.call(e)==="[object Object]"}throw new Error(n+" not supported as a type.Please use one of object, string, array, number, boolean or null.")}var Cr={$elemMatch:function(e,n,r,t){return!Array.isArray(t)||t.length===0?!1:typeof t[0]=="object"?t.some(function(i){return le(i,n,Object.keys(n))}):t.some(function(i){return Jn(n,e,r,i)})},$allMatch:function(e,n,r,t){return!Array.isArray(t)||t.length===0?!1:typeof t[0]=="object"?t.every(function(i){return le(i,n,Object.keys(n))}):t.every(function(i){return Jn(n,e,r,i)})},$eq:function(e,n,r,t){return fe(t)&&W(t,n)===0},$gte:function(e,n,r,t){return fe(t)&&W(t,n)>=0},$gt:function(e,n,r,t){return fe(t)&&W(t,n)>0},$lte:function(e,n,r,t){return fe(t)&&W(t,n)<=0},$lt:function(e,n,r,t){return fe(t)&&W(t,n)<0},$exists:function(e,n,r,t){return n?fe(t):!fe(t)},$mod:function(e,n,r,t){return Ae(t)&&jo(t,n)},$ne:function(e,n,r,t){return n.every(function(i){return W(t,i)!==0})},$in:function(e,n,r,t){return Ae(t)&&Fr(t,n)},$nin:function(e,n,r,t){return Ae(t)&&!Fr(t,n)},$size:function(e,n,r,t){return Ae(t)&&Co(t,n)},$all:function(e,n,r,t){return Array.isArray(t)&&Fo(t,n)},$regex:function(e,n,r,t){return Ae(t)&&To(t,n)},$type:function(e,n,r,t){return Po(t,n)}};function Lo(e,n){if(typeof n!="object")throw new Error("Selector error: expected a JSON object");n=_t(n);var r={doc:e},t=wt([r],{selector:n},Object.keys(n));return t&&t.length===1}const No=Object.freeze(Object.defineProperty({__proto__:null,compare:gt,createFieldSorter:$t,filterInMemoryFields:wt,getFieldFromDoc:ar,getKey:fr,getValue:mt,isCombinationalField:ur,massageSelector:_t,matchesSelector:Lo,parseField:or,rowFilter:le,setFieldInDoc:bo},Symbol.toStringTag,{value:"Module"})),sr=Nr(No);var Ge={},hn=sr,Tr=hn.getKey,Bo=hn.getFieldFromDoc,Ro=hn.setFieldInDoc,Uo=hn.parseField;Ge.getUserFields=function(e,n){var r=Object.keys(e),t=n?n.map(Tr):[],i;return r.length>=t.length?i=r:i=t,t.length===0?{fields:i}:(i=i.sort(function(a,o){var u=t.indexOf(a);u===-1&&(u=Number.MAX_VALUE);var f=t.indexOf(o);return f===-1&&(f=Number.MAX_VALUE),u<f?-1:u>f?1:0}),{fields:i,sortOrder:n.map(Tr)})};Ge.massageSort=function(e){if(!Array.isArray(e))throw new Error("invalid sort json - should be an array");return e.map(function(n){if(typeof n=="string"){var r={};return r[n]="asc",r}else return n})};Ge.pick=function(e,n){for(var r={},t=0,i=n.length;t<i;t++){var a=Uo(n[t]),o=Bo(e,a);typeof o<"u"&&Ro(r,a,o)}return r};var zo=it.collate,Ke=sr,Qo=Ke.filterInMemoryFields,Mo=Ge,Jo=Ke.compare,qo=Mo.getUserFields,Go=Ke.getKey,Ko=Ke.getValue,Wo=Ke.parseField,Ho=nr.memoryFilter=function(e,n){var r=qo(n.selector,n.sort),t=r.fields,i=e.map(function(a){return{doc:a}});return Qo(i,n,t).map(function(a){return a.doc})},Xo=nr.createFieldSorter=function(e){function n(t){return e.map(function(i){var a=Go(i),o=Wo(a),u=Yo(t,o);return u})}var r=e.map(function(t){return typeof t!="string"&&Ko(t)==="desc"?-1:1});return function(t,i){for(var a=n(t),o=n(i),u=0,f=r.length;u<f;u++){var c=zo(a[u],o[u]);if(c!==0)return c*r[u]}return Jo(t._id,i._id)*r[0]}};function Yo(e,n){for(var r=e,t=0,i=n.length;t<i;t++){var a=n[t];if(r=r[a],!r)break}return r}(function(e){var n=un,r=nr;it.collate;var t=sr,i=Ge;t.getValue;var a=t.massageSelector,o=i.massageSort;function u(f){if(typeof this.find!="function")throw new Error("ERROR: PouchDB Find is a requirement for LiveFind and must be loaded first.");var c=this,g=!1,h={},y=new n,x=[],j=f.aggregate||!1,b=f.fields,A=!1,O=!1;b&&(b.indexOf("_id")===-1&&(b.unshift("_id"),A=!0),b.indexOf("_rev")===-1&&(b.push("_rev"),O=!0));var B;f.selector&&(B=a(f.selector));var L,V;f.sort&&(L=o(f.sort),V=r.createFieldSorter(L));var H=parseInt(f.skip,10)||0,X=parseInt(f.limit,10)||0,ee={selector:B,fields:b},G=c.find(ee).then(function(v){v.docs.forEach(function(_){gn(_)}),y.emit("ready")}).catch(function(v){throw y.emit("error",v),We(),v});c._changeListener||yn(),c._activeQueries?c._activeQueries++:c._activeQueries=1,c._changeListener.on("change",pe).on("error",ge),y.cancel=We,y.then=G.then.bind(G),y.catch=G.catch.bind(G),y.sort=function(v){return L?p(v):v},y.paginate=E;function pe(v){G.then(function(){v.doc&&mn(v.doc)})}function ge(v){y.emit("error",v)}function We(){g||(c._activeQueries--,c._activeQueries?(c._changeListener.removeListener("change",pe),c._changeListener.removeListener("error",ge)):(c._changeListener.cancel(),delete c._changeListener),y.emit("cancelled"),y.removeAllListeners(),g=!0)}function yn(){c._changeListener=c.changes({live:!0,retry:!0,include_docs:!0,since:"now"})}function pn(v){var _=r.memoryFilter([v],{selector:B});return _.length?_[0]:null}function He(v){if(b){var _=i.pick(v,b);return A&&delete _._id,O&&delete _._rev,_}return v}function gn(v){h[v._id]=v._rev;var _=v._id,w=v._rev;return A&&delete v._id,O&&delete v._rev,l(v,_,w)}function mn(v){if(h[v._id]!==v._rev){var _=v._id,w=v._rev;if(v._deleted&&h[_])return h[_]=null,s({_id:_,_rev:w,deleted:!0},_,w);var k=pn(v);if(!k&&h[_])return h[_]=null,s({_id:_,_rev:w},_,w);if(k&&!h[_])return h[_]=w,l(He(k),_,w);if(k&&h[_])return h[_]=w,d(He(k),_,w)}}function s(v,_,w){var k;j&&(x=x.filter(function(I){return I._id!==v._id}),k=$(x)),y.emit("update",{action:"REMOVE",id:_,rev:w,doc:v},k)}function l(v,_,w){var k;j&&(x=x.concat(v),k=$(x)),y.emit("update",{action:"ADD",id:_,rev:w,doc:v},k)}function d(v,_,w){var k;j&&(x=x.map(function(I){return I._id===v._id?v:I}),k=$(x)),y.emit("update",{action:"UPDATE",id:_,rev:w,doc:v},k)}function p(v){return v.sort(V)}function $(v){return L&&(v=p(v)),(H||X)&&(X?v=v.slice(H,H+X):v=v.slice(H)),v}function E(v){if(!(!j||!v||typeof v!="object"))return v.skip!=null&&(H=parseInt(v.skip,10)||0),v.limit!=null&&(X=parseInt(v.limit,10)||0),v.sort&&v.sort instanceof Array&&(L=o(v.sort),V=r.createFieldSorter(L)),$(x)}return y}e.liveFind=u,typeof window<"u"&&window.PouchDB&&window.PouchDB.plugin(e)})(rt);const Zo=on(rt),{massageSelector:Vo,massageSort:tu}=bi;function Do(e){e.prototype.asSvelteStore=function(n){const r=this;let t;const i=kt([],f=>{f||r.close()});r.deltaInit(),r.delta.on("create",f=>{a(f)&&(t[f.$id]=f,o())}).on("update",f=>{const c={...t[f.$id],...f};a(c)?t[f.$id]=c:delete t[f.$id],o()}).on("delete",f=>{delete t[f],o()});function a(f){return n==null?!0:Ho([f],n).length>0}function o(){console.log(t);const f=Object.values(t);n.sortFn&&f.sort(n.sortFn),i.set(f)}async function u(f){if(f){n=f?{...n??{},...f}:n,n.selector&&(n.selector=Vo(n.selector)),n.sort&&(n.sortFn=Xo(n.sort)),t={};const{docs:c,warning:g}=await r.find(n);g&&console.warn(g),c.forEach(h=>t[h.$id]=h)}else t=await r.all();o()}return u(n),{subscribe:i.subscribe,updateSearch:u}}}function Pr(e,n,r){const t=e.slice();return t[11]=n[r],t}function Lr(e,n){let r,t=JSON.stringify(n[11])+"",i,a,o=n[11].$id+"",u,f,c,g,h,y,x,j;function b(...O){return n[9](n[11],...O)}function A(){return n[10](n[11])}return{key:e,first:null,c(){r=ae("div"),i=On(t),a=je(),u=On(o),f=je(),c=ae("input"),h=je(),y=ae("button"),y.textContent="❎",c.value=g=n[11].title,this.first=r},m(O,B){re(O,r,B),te(r,i),re(O,a,B),re(O,u,B),re(O,f,B),re(O,c,B),re(O,h,B),re(O,y,B),x||(j=[Fe(c,"change",b),Fe(y,"click",A)],x=!0)},p(O,B){n=O,B&8&&t!==(t=JSON.stringify(n[11])+"")&&lr(i,t),B&8&&o!==(o=n[11].$id+"")&&lr(u,o),B&8&&g!==(g=n[11].title)&&c.value!==g&&(c.value=g)},d(O){O&&ie(r),O&&ie(a),O&&ie(u),O&&ie(f),O&&ie(c),O&&ie(h),O&&ie(y),x=!1,Br(j)}}}function eu(e){let n,r,t,i,a,o,u,f,c=[],g=new Map,h,y,x=e[3];const j=b=>b[11].$id;for(let b=0;b<x.length;b+=1){let A=Pr(e,x,b),O=j(A);g.set(O,c[b]=Lr(O,A))}return{c(){n=ae("div"),r=ae("input"),t=ae("button"),t.textContent="Submit",i=je(),a=ae("label"),o=On(`Filter
        `),u=ae("input"),f=je();for(let b=0;b<c.length;b+=1)c[b].c()},m(b,A){re(b,n,A),te(n,r),Xe(r,e[2]),te(n,t),te(n,i),te(n,a),te(a,o),te(a,u),Xe(u,e[1]),te(n,f);for(let O=0;O<c.length;O+=1)c[O]&&c[O].m(n,null);h||(y=[Fe(r,"input",e[6]),Fe(t,"click",e[7]),Fe(u,"input",e[8])],h=!0)},p(b,[A]){A&4&&r.value!==b[2]&&Xe(r,b[2]),A&2&&u.value!==b[1]&&Xe(u,b[1]),A&56&&(x=b[3],c=At(c,A,j,1,b,x,g,n,jt,Lr,null,Pr))},i:En,o:En,d(b){b&&ie(n);for(let A=0;A<c.length;A+=1)c[A].d();h=!1,Br(y)}}}function nu(e,n,r){let t,i=En,a=()=>(i(),i=Ft(u,A=>r(3,t=A)),u);e.$$.on_destroy.push(()=>i()),Oe.plugin(St),Oe.plugin(we),Oe.plugin(Zo),Oe.plugin(Do);const o=new Oe("test");o.createIndex({index:{fields:["title"]}}).then(()=>a(r(0,u=o.asSvelteStore())));let u=It([]);a();let f,c;function g(A=void 0,O=void 0){o.save({$id:A,title:O??f}).then(function(B){console.log(B)})}function h(){f=this.value,r(2,f)}const y=()=>g();function x(){c=this.value,r(1,c)}const j=(A,O)=>g(A.$id,O.target.value),b=A=>o.delete(A.$id).then(console.log);return e.$$.update=()=>{var A;e.$$.dirty&3&&((A=u.updateSearch)==null||A.call(u,{selector:{title:c}}))},[u,c,f,t,o,g,h,y,x,j,b]}class iu extends xt{constructor(n){super(),Ot(this,n,nu,eu,Et,{})}}export{iu as default};
