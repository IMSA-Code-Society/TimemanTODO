import{M as wr,E as Te,F as Bt,G as Y,H as an,I as un,J as br,S as kr,i as xr,s as Or,e as ie,a as je,K as Sn,c as ne,d as te,p as We,l as Fe,L as Er,n as ct,f as re,r as Rt,P as Oe,N as Ar,O as Sr,Q as lt,R as Ir}from"./index-6810f923.js";let P=class extends Error{constructor(n,t,r){super(),this.status=n,this.name=t,this.message=r,this.error=!0}toString(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})}};new P(401,"unauthorized","Name or password is incorrect.");new P(400,"bad_request","Missing JSON list of 'docs'");new P(404,"not_found","missing");new P(409,"conflict","Document update conflict");new P(400,"bad_request","_id field must contain a string");new P(412,"missing_id","_id is required for puts");new P(400,"bad_request","Only reserved document ids may start with underscore.");new P(412,"precondition_failed","Database not open");var jr=new P(500,"unknown_error","Database encountered an unknown error");new P(500,"badarg","Some query argument is invalid");new P(400,"invalid_request","Request was invalid");new P(400,"query_parse_error","Some query parameter is invalid");new P(500,"doc_validation","Bad special document member");new P(400,"bad_request","Something wrong with the request");new P(400,"bad_request","Document must be a JSON object");new P(404,"not_found","Database not found");new P(500,"indexed_db_went_bad","unknown");new P(500,"web_sql_went_bad","unknown");new P(500,"levelDB_went_went_bad","unknown");new P(403,"forbidden","Forbidden by design doc validate_doc_update function");new P(400,"bad_request","Invalid rev format");new P(412,"file_exists","The database could not be created, the file already exists.");new P(412,"missing_stub","A pre-existing attachment stub wasn't found");new P(413,"invalid_url","Provided URL is invalid");function In(e){if(typeof e!="object"){var n=e;e=jr,e.data=n}return"error"in e&&e.error==="conflict"&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),"stack"in e||(e.stack=new Error().stack),e}var Ve=Headers;function sn(e){return"$"+e}function Ut(e){return e.substring(1)}function V(){this._store={}}V.prototype.get=function(e){var n=sn(e);return this._store[n]};V.prototype.set=function(e,n){var t=sn(e);return this._store[t]=n,!0};V.prototype.has=function(e){var n=sn(e);return n in this._store};V.prototype.keys=function(){return Object.keys(this._store).map(e=>Ut(e))};V.prototype.delete=function(e){var n=sn(e),t=n in this._store;return delete this._store[n],t};V.prototype.forEach=function(e){for(var n=Object.keys(this._store),t=0,r=n.length;t<r;t++){var i=n[t],o=this._store[i];i=Ut(i),e(o,i)}};Object.defineProperty(V.prototype,"size",{get:function(){return Object.keys(this._store).length}});function Pe(e){if(this._store=new V,e&&Array.isArray(e))for(var n=0,t=e.length;n<t;n++)this.add(e[n])}Pe.prototype.add=function(e){return this._store.set(e,!0)};Pe.prototype.has=function(e){return this._store.has(e)};Pe.prototype.forEach=function(e){this._store.forEach(function(n,t){e(t)})};Object.defineProperty(Pe.prototype,"size",{get:function(){return this._store.size}});function Fr(){if(typeof Symbol>"u"||typeof Map>"u"||typeof Set>"u")return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}var Ce,me;Fr()?(Ce=Set,me=Map):(Ce=Pe,me=V);var Tr=function(e){return atob(e)};function Cr(e,n){e=e||[],n=n||{};try{return new Blob(e,n)}catch(o){if(o.name!=="TypeError")throw o;for(var t=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,r=new t,i=0;i<e.length;i+=1)r.append(e[i]);return r.getBlob(n.type)}}function Nr(e){for(var n=e.length,t=new ArrayBuffer(n),r=new Uint8Array(t),i=0;i<n;i++)r[i]=e.charCodeAt(i);return t}function Pr(e,n){return Cr([Nr(e)],{type:n})}function Lr(e,n){return Pr(Tr(e),n)}function Br(e,n,t){for(var r="",i=t-e.length;r.length<i;)r+=n;return r}function Rr(e,n,t){var r=Br(e,n,t);return r+e}var zt=-324,jn=3,Fn="";function Q(e,n){if(e===n)return 0;e=de(e),n=de(n);var t=Tn(e),r=Tn(n);if(t-r!==0)return t-r;switch(typeof e){case"number":return e-n;case"boolean":return e<n?-1:1;case"string":return Jr(e,n)}return Array.isArray(e)?qr(e,n):Gr(e,n)}function de(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var n=e;if(Array.isArray(e)){var t=e.length;e=new Array(t);for(var r=0;r<t;r++)e[r]=de(n[r])}else{if(e instanceof Date)return e.toJSON();if(e!==null){e={};for(var i in n)if(Object.prototype.hasOwnProperty.call(n,i)){var o=n[i];typeof o<"u"&&(e[i]=de(o))}}}}return e}function Ur(e){if(e!==null)switch(typeof e){case"boolean":return e?1:0;case"number":return Kr(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var n=Array.isArray(e),t=n?e:Object.keys(e),r=-1,i=t.length,o="";if(n)for(;++r<i;)o+=K(t[r]);else for(;++r<i;){var a=t[r];o+=K(a)+K(e[a])}return o}return""}function K(e){var n="\0";return e=de(e),Tn(e)+Fn+Ur(e)+n}function zr(e,n){var t=n,r,i=e[n]==="1";if(i)r=0,n++;else{var o=e[n]==="0";n++;var a="",u=e.substring(n,n+jn),s=parseInt(u,10)+zt;for(o&&(s=-s),n+=jn;;){var l=e[n];if(l==="\0")break;a+=l,n++}a=a.split("."),a.length===1?r=parseInt(a,10):r=parseFloat(a[0]+"."+a[1]),o&&(r=r-10),s!==0&&(r=parseFloat(r+"e"+s))}return{num:r,length:n-t}}function Qr(e,n){var t=e.pop();if(n.length){var r=n[n.length-1];t===r.element&&(n.pop(),r=n[n.length-1]);var i=r.element,o=r.index;if(Array.isArray(i))i.push(t);else if(o===e.length-2){var a=e.pop();i[a]=t}else e.push(t)}}function Mr(e){for(var n=[],t=[],r=0;;){var i=e[r++];if(i==="\0"){if(n.length===1)return n.pop();Qr(n,t);continue}switch(i){case"1":n.push(null);break;case"2":n.push(e[r]==="1"),r++;break;case"3":var o=zr(e,r);n.push(o.num),r+=o.length;break;case"4":for(var a="";;){var u=e[r];if(u==="\0")break;a+=u,r++}a=a.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),n.push(a);break;case"5":var s={element:[],index:n.length};n.push(s.element),t.push(s);break;case"6":var l={element:{},index:n.length};n.push(l.element),t.push(l);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}}}function qr(e,n){for(var t=Math.min(e.length,n.length),r=0;r<t;r++){var i=Q(e[r],n[r]);if(i!==0)return i}return e.length===n.length?0:e.length>n.length?1:-1}function Jr(e,n){return e===n?0:e>n?1:-1}function Gr(e,n){for(var t=Object.keys(e),r=Object.keys(n),i=Math.min(t.length,r.length),o=0;o<i;o++){var a=Q(t[o],r[o]);if(a!==0||(a=Q(e[t[o]],n[r[o]]),a!==0))return a}return t.length===r.length?0:t.length>r.length?1:-1}function Tn(e){var n=["boolean","number","string","object"],t=n.indexOf(typeof e);if(~t)return e===null?1:Array.isArray(e)?5:t<3?t+2:t+3;if(Array.isArray(e))return 5}function Kr(e){if(e===0)return"1";var n=e.toExponential().split(/e\+?/),t=parseInt(n[1],10),r=e<0,i=r?"0":"2",o=(r?-t:t)-zt,a=Rr(o.toString(),"0",jn);i+=Fn+a;var u=Math.abs(parseFloat(n[0]));r&&(u=10-u);var s=u.toFixed(20);return s=s.replace(/\.?0+$/,""),i+=Fn+s,i}function Qt(e){return wr.hash(e)}function Hr(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer||typeof Blob<"u"&&e instanceof Blob}function Xr(e){if(typeof e.slice=="function")return e.slice(0);var n=new ArrayBuffer(e.byteLength),t=new Uint8Array(n),r=new Uint8Array(e);return t.set(r),n}function Wr(e){if(e instanceof ArrayBuffer)return Xr(e);var n=e.size,t=e.type;return typeof e.slice=="function"?e.slice(0,n,t):e.webkitSlice(0,n,t)}var Mt=Function.prototype.toString,Yr=Mt.call(Object);function Zr(e){var n=Object.getPrototypeOf(e);if(n===null)return!0;var t=n.constructor;return typeof t=="function"&&t instanceof t&&Mt.call(t)==Yr}function oe(e){var n,t,r;if(!e||typeof e!="object")return e;if(Array.isArray(e)){for(n=[],t=0,r=e.length;t<r;t++)n[t]=oe(e[t]);return n}if(e instanceof Date&&isFinite(e))return e.toISOString();if(Hr(e))return Wr(e);if(!Zr(e))return e;n={};for(t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var i=oe(e[t]);typeof i<"u"&&(n[t]=i)}return n}function Vr(e){var n=!1;return function(...t){if(n)throw new Error("once called more than once");n=!0,e.apply(this,t)}}function Le(e){return function(...n){n=oe(n);var t=this,r=typeof n[n.length-1]=="function"?n.pop():!1,i=new Promise(function(o,a){var u;try{var s=Vr(function(l,w){l?a(l):o(w)});n.push(s),u=e.apply(t,n),u&&typeof u.then=="function"&&o(u)}catch(l){a(l)}});return r&&i.then(function(o){r(null,o)},r),i}}var dt;try{localStorage.setItem("_pouch_check_localstorage",1),dt=!!localStorage.getItem("_pouch_check_localstorage")}catch{dt=!1}function Cn(e){if(typeof console<"u"&&typeof console[e]=="function"){var n=Array.prototype.slice.call(arguments,1);console[e].apply(console,n)}}var Nn;typeof Object.assign=="function"?Nn=Object.assign:Nn=function(e){for(var n=Object(e),t=1;t<arguments.length;t++){var r=arguments[t];if(r!=null)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])}return n};var Hn=Nn;function vt(e){for(var n=[],t=0,r=e.length;t<r;t++)n=n.concat(e[t]);return n}function ve(e){return typeof e._remote=="boolean"?e._remote:typeof e.type=="function"?(Cn("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),e.type()==="http"):!1}function fn(e,n,t){return e.get(n).catch(function(r){if(r.status!==404)throw r;return{}}).then(function(r){var i=r._rev,o=t(r);return o?(o._id=n,o._rev=i,Dr(e,o,t)):{updated:!1,rev:i}})}function Dr(e,n,t){return e.put(n).then(function(r){return{updated:!0,rev:r.rev}},function(r){if(r.status!==409)throw r;return fn(e,n._id,t)})}class fe extends Error{constructor(n){super(),this.status=400,this.name="query_parse_error",this.message=n,this.error=!0;try{Error.captureStackTrace(this,fe)}catch{}}}class Xn extends Error{constructor(n){super(),this.status=404,this.name="not_found",this.message=n,this.error=!0;try{Error.captureStackTrace(this,Xn)}catch{}}}class Wn extends Error{constructor(n){super(),this.status=500,this.name="invalid_value",this.message=n,this.error=!0;try{Error.captureStackTrace(this,Wn)}catch{}}}function qt(e,n){return n&&e.then(function(t){Te(function(){n(null,t)})},function(t){Te(function(){n(t)})}),e}function ei(e){return function(...n){var t=n.pop(),r=e.apply(this,n);return typeof t=="function"&&qt(r,t),r}}function ni(e,n){return e.then(function(t){return n().then(function(){return t})},function(t){return n().then(function(){throw t})})}function wn(e,n){return function(){var t=arguments,r=this;return e.add(function(){return n.apply(r,t)})}}function yt(e){var n=new Ce(e),t=new Array(n.size),r=-1;return n.forEach(function(i){t[++r]=i}),t}function bn(e){var n=new Array(e.size),t=-1;return e.forEach(function(r,i){n[++t]=i}),n}class Pn{constructor(){this.promise=new Promise(function(n){n()})}add(n){return this.promise=this.promise.catch(function(){}).then(function(){return n()}),this.promise}finish(){return this.promise}}function pt(e){if(!e)return"undefined";switch(typeof e){case"function":return e.toString();case"string":return e.toString();default:return JSON.stringify(e)}}function ti(e,n){return pt(e)+pt(n)+"undefined"}async function ht(e,n,t,r,i,o){const a=ti(t,r);let u;if(!i&&(u=e._cachedViews=e._cachedViews||{},u[a]))return u[a];const s=e.info().then(async function(l){const w=l.db_name+"-mrview-"+(i?"temp":Qt(a));function y(E){E.views=E.views||{};let x=n;x.indexOf("/")===-1&&(x=n+"/"+n);const L=E.views[x]=E.views[x]||{};if(!L[w])return L[w]=!0,E}await fn(e,"_local/"+o,y);const O=(await e.registerDependentDatabase(w)).db;O.auto_compaction=!0;const j={name:w,db:O,sourceDB:e,adapter:e.adapter,mapFun:t,reduceFun:r};let k;try{k=await j.db.get("_local/lastSeq")}catch(E){if(E.status!==404)throw E}return j.seq=k?k.seq:0,u&&j.db.once("destroyed",function(){delete u[a]}),j});return u&&(u[a]=s),s}var gt={},mt=new Pn,ri=50;function kn(e){return e.indexOf("/")===-1?[e,e]:e.split("/")}function ii(e){return e.length===1&&/^1-/.test(e[0].rev)}function _t(e,n,t){try{e.emit("error",n)}catch{Cn("error",`The user's map/reduce function threw an uncaught error.
You can debug this error by doing:
myDatabase.on('error', function (err) { debugger; });
Please double-check your map/reduce function.`),Cn("error",n,t)}}function oi(e,n,t,r){function i(f,c,d){try{c(d)}catch(p){_t(f,p,{fun:c,doc:d})}}function o(f,c,d,p,b){try{return{output:c(d,p,b)}}catch(v){return _t(f,v,{fun:c,keys:d,values:p,rereduce:b}),{error:v}}}function a(f,c){const d=Q(f.key,c.key);return d!==0?d:Q(f.value,c.value)}function u(f,c,d){return d=d||0,typeof c=="number"?f.slice(d,c+d):d>0?f.slice(d):f}function s(f){const c=f.value;return c&&typeof c=="object"&&c._id||f.id}function l(f){f.rows.forEach(function(c){const d=c.doc&&c.doc._attachments;d&&Object.keys(d).forEach(function(p){const b=d[p];d[p].data=Lr(b.data,b.content_type)})})}function w(f){return function(c){return f.include_docs&&f.attachments&&f.binary&&l(c),c}}function y(f,c,d,p){let b=c[f];typeof b<"u"&&(p&&(b=encodeURIComponent(JSON.stringify(b))),d.push(f+"="+b))}function g(f){if(typeof f<"u"){const c=Number(f);return!isNaN(c)&&c===parseInt(f,10)?c:f}}function O(f){return f.group_level=g(f.group_level),f.limit=g(f.limit),f.skip=g(f.skip),f}function j(f){if(f){if(typeof f!="number")return new fe(`Invalid value for integer: "${f}"`);if(f<0)return new fe(`Invalid value for positive integer: "${f}"`)}}function k(f,c){const d=f.descending?"endkey":"startkey",p=f.descending?"startkey":"endkey";if(typeof f[d]<"u"&&typeof f[p]<"u"&&Q(f[d],f[p])>0)throw new fe("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(c.reduce&&f.reduce!==!1){if(f.include_docs)throw new fe("{include_docs:true} is invalid for reduce");if(f.keys&&f.keys.length>1&&!f.group&&!f.group_level)throw new fe("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(b){const v=j(f[b]);if(v)throw v})}async function E(f,c,d){let p=[],b,v="GET",$;if(y("reduce",d,p),y("include_docs",d,p),y("attachments",d,p),y("limit",d,p),y("descending",d,p),y("group",d,p),y("group_level",d,p),y("skip",d,p),y("stale",d,p),y("conflicts",d,p),y("startkey",d,p,!0),y("start_key",d,p,!0),y("endkey",d,p,!0),y("end_key",d,p,!0),y("inclusive_end",d,p),y("key",d,p,!0),y("update_seq",d,p),p=p.join("&"),p=p===""?"":"?"+p,typeof d.keys<"u"){const A=`keys=${encodeURIComponent(JSON.stringify(d.keys))}`;A.length+p.length+1<=2e3?p+=(p[0]==="?"?"&":"?")+A:(v="POST",typeof c=="string"?b={keys:d.keys}:c.keys=d.keys)}if(typeof c=="string"){const _=kn(c),A=await f.fetch("_design/"+_[0]+"/_view/"+_[1]+p,{headers:new Ve({"Content-Type":"application/json"}),method:v,body:JSON.stringify(b)});$=A.ok;const F=await A.json();if(!$)throw F.status=A.status,In(F);return F.rows.forEach(function(I){if(I.value&&I.value.error&&I.value.error==="builtin_reduce_error")throw new Error(I.reason)}),new Promise(function(I){I(F)}).then(w(d))}b=b||{},Object.keys(c).forEach(function(_){Array.isArray(c[_])?b[_]=c[_]:b[_]=c[_].toString()});const h=await f.fetch("_temp_view"+p,{headers:new Ve({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(b)});$=h.ok;const m=await h.json();if(!$)throw m.status=h.status,In(m);return new Promise(function(_){_(m)}).then(w(d))}function x(f,c,d){return new Promise(function(p,b){f._query(c,d,function(v,$){if(v)return b(v);p($)})})}function L(f){return new Promise(function(c,d){f._viewCleanup(function(p,b){if(p)return d(p);c(b)})})}function R(f){return function(c){if(c.status===404)return f;throw c}}async function Z(f,c,d){const p="_local/doc_"+f,b={_id:p,keys:[]},v=d.get(f),$=v[0],h=v[1];function m(){return ii(h)?Promise.resolve(b):c.db.get(p).catch(R(b))}function _(G){return G.keys.length?c.db.allDocs({keys:G.keys,include_docs:!0}):Promise.resolve({rows:[]})}function A(G,W){const ge=[],He=new Ce;for(let S=0,T=W.rows.length;S<T;S++){const z=W.rows[S].doc;if(z&&(ge.push(z),He.add(z._id),z._deleted=!$.has(z._id),!z._deleted)){const U=$.get(z._id);"value"in U&&(z.value=U.value)}}const Xe=bn($);return Xe.forEach(function(S){if(!He.has(S)){const T={_id:S},N=$.get(S);"value"in N&&(T.value=N.value),ge.push(T)}}),G.keys=yt(Xe.concat(G.keys)),ge.push(G),ge}const F=await m(),I=await _(F);return A(F,I)}function X(f){return f.sourceDB.get("_local/purges").then(function(c){const d=c.purgeSeq;return f.db.get("_local/purgeSeq").then(function(p){return p._rev}).catch(function(p){if(p.status!==404)throw p}).then(function(p){return f.db.put({_id:"_local/purgeSeq",_rev:p,purgeSeq:d})})}).catch(function(c){if(c.status!==404)throw c})}function D(f,c,d){var p="_local/lastSeq";return f.db.get(p).catch(R({_id:p,seq:0})).then(function(b){var v=bn(c);return Promise.all(v.map(function($){return Z($,f,c)})).then(function($){var h=vt($);return b.seq=d,h.push(b),f.db.bulkDocs({docs:h})}).then(()=>X(f))})}function ee(f){const c=typeof f=="string"?f:f.name;let d=gt[c];return d||(d=gt[c]=new Pn),d}async function J(f,c){return wn(ee(f),function(){return pe(f,c)})()}async function pe(f,c){let d,p,b;function v(S,T){const N={id:p._id,key:de(S)};typeof T<"u"&&T!==null&&(N.value=de(T)),d.push(N)}const $=n(f.mapFun,v);let h=f.seq||0;function m(){return f.sourceDB.info().then(function(S){b=f.sourceDB.activeTasks.add({name:"view_indexing",total_items:S.update_seq-h})})}function _(S,T){return function(){return D(f,S,T)}}let A=0;const F={view:f.name,indexed_docs:A};f.sourceDB.emit("indexing",F);const I=new Pn;async function G(){const S=await f.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:h,limit:c.changes_batch_size}),T=await W();return ge(S,T)}function W(){return f.db.get("_local/purgeSeq").then(function(S){return S.purgeSeq}).catch(function(S){if(S&&S.status!==404)throw S;return-1}).then(function(S){return f.sourceDB.get("_local/purges").then(function(T){const N=T.purges.filter(function(U,B){return B>S}).map(U=>U.docId),z=N.filter(function(U,B){return N.indexOf(U)===B});return Promise.all(z.map(function(U){return f.sourceDB.get(U).then(function(B){return{docId:U,doc:B}}).catch(function(B){if(B.status!==404)throw B;return{docId:U}})}))}).catch(function(T){if(T&&T.status!==404)throw T;return[]})})}function ge(S,T){var N=S.results;if(!N.length&&!T.length)return;for(let B of T)if(N.findIndex(function(xe){return xe.id===B.docId})<0){const xe={_id:B.docId,doc:{_id:B.docId,_deleted:1},changes:[]};B.doc&&(xe.doc=B.doc,xe.changes.push({rev:B.doc._rev})),N.push(xe)}var z=He(N);I.add(_(z,h)),A=A+N.length;const U={view:f.name,last_seq:S.last_seq,results_count:N.length,indexed_docs:A};if(f.sourceDB.emit("indexing",U),f.sourceDB.activeTasks.update(b,{completed_items:A}),!(N.length<c.changes_batch_size))return G()}function He(S){const T=new me;for(let N=0,z=S.length;N<z;N++){const U=S[N];if(U.doc._id[0]!=="_"){d=[],p=U.doc,p._deleted||i(f.sourceDB,$,p),d.sort(a);const B=Xe(d);T.set(U.doc._id,[B,U.changes])}h=U.seq}return T}function Xe(S){const T=new me;let N;for(let z=0,U=S.length;z<U;z++){const B=S[z],$n=[B.key,B.id];z>0&&Q(B.key,N)===0&&$n.push(z),T.set(K($n),B),N=B.key}return T}try{await m(),await G(),await I.finish(),f.seq=h,f.sourceDB.activeTasks.remove(b)}catch(S){f.sourceDB.activeTasks.remove(b,S)}}function Je(f,c,d){d.group_level===0&&delete d.group_level;const p=d.group||d.group_level,b=t(f.reduceFun),v=[],$=isNaN(d.group_level)?Number.POSITIVE_INFINITY:d.group_level;c.forEach(function(h){const m=v[v.length-1];let _=p?h.key:null;if(p&&Array.isArray(_)&&(_=_.slice(0,$)),m&&Q(m.groupKey,_)===0){m.keys.push([h.key,h.id]),m.values.push(h.value);return}v.push({keys:[[h.key,h.id]],values:[h.value],groupKey:_})}),c=[];for(let h=0,m=v.length;h<m;h++){const _=v[h],A=o(f.sourceDB,b,_.keys,_.values,!1);if(A.error&&A.error instanceof Wn)throw A.error;c.push({value:A.error?null:A.output,key:_.groupKey})}return{rows:u(c,d.limit,d.skip)}}function he(f,c){return wn(ee(f),function(){return hn(f,c)})()}async function hn(f,c){let d;const p=f.reduceFun&&c.reduce!==!1,b=c.skip||0;typeof c.keys<"u"&&!c.keys.length&&(c.limit=0,delete c.keys);async function v(h){h.include_docs=!0;const m=await f.db.allDocs(h);return d=m.total_rows,m.rows.map(function(_){if("value"in _.doc&&typeof _.doc.value=="object"&&_.doc.value!==null){const F=Object.keys(_.doc.value).sort(),I=["id","key","value"];if(!(F<I||F>I))return _.doc.value}const A=Mr(_.doc._id);return{key:A[0],id:A[1],value:"value"in _.doc?_.doc.value:null}})}async function $(h){let m;if(p?m=Je(f,h,c):typeof c.keys>"u"?m={total_rows:d,offset:b,rows:h}:m={total_rows:d,offset:b,rows:u(h,c.limit,c.skip)},c.update_seq&&(m.update_seq=f.seq),c.include_docs){const A=yt(h.map(s)),F=await f.sourceDB.allDocs({keys:A,include_docs:!0,conflicts:c.conflicts,attachments:c.attachments,binary:c.binary});var _=new me;return F.rows.forEach(function(I){_.set(I.id,I.doc)}),h.forEach(function(I){var G=s(I),W=_.get(G);W&&(I.doc=W)}),m}else return m}if(typeof c.keys<"u"){const m=c.keys.map(function(F){const I={startkey:K([F]),endkey:K([F,{}])};return c.update_seq&&(I.update_seq=!0),v(I)}),_=await Promise.all(m),A=vt(_);return $(A)}else{const h={descending:c.descending};c.update_seq&&(h.update_seq=!0);let m,_;if("start_key"in c&&(m=c.start_key),"startkey"in c&&(m=c.startkey),"end_key"in c&&(_=c.end_key),"endkey"in c&&(_=c.endkey),typeof m<"u"&&(h.startkey=c.descending?K([m,{}]):K([m])),typeof _<"u"){let F=c.inclusive_end!==!1;c.descending&&(F=!F),h.endkey=K(F?[_,{}]:[_])}if(typeof c.key<"u"){const F=K([c.key]),I=K([c.key,{}]);h.descending?(h.endkey=F,h.startkey=I):(h.startkey=F,h.endkey=I)}p||(typeof c.limit=="number"&&(h.limit=c.limit),h.skip=b);const A=await v(h);return $(A)}}async function gn(f){return(await f.fetch("_view_cleanup",{headers:new Ve({"Content-Type":"application/json"}),method:"POST"})).json()}async function Ge(f){try{const c=await f.get("_local/"+e),d=new me;Object.keys(c.views).forEach(function(m){const _=kn(m),A="_design/"+_[0],F=_[1];let I=d.get(A);I||(I=new Ce,d.set(A,I)),I.add(F)});const p={keys:bn(d),include_docs:!0},b=await f.allDocs(p),v={};b.rows.forEach(function(m){const _=m.key.substring(8);d.get(m.key).forEach(function(A){let F=_+"/"+A;c.views[F]||(F=A);const I=Object.keys(c.views[F]),G=m.doc&&m.doc.views&&m.doc.views[A];I.forEach(function(W){v[W]=v[W]||G})})});const h=Object.keys(v).filter(function(m){return!v[m]}).map(function(m){return wn(ee(m),function(){return new f.constructor(m,f.__opts).destroy()})()});return Promise.all(h).then(function(){return{ok:!0}})}catch(c){if(c.status===404)return{ok:!0};throw c}}async function mn(f,c,d){if(typeof f._query=="function")return x(f,c,d);if(ve(f))return E(f,c,d);const p={changes_batch_size:f.__opts.view_update_changes_batch_size||ri};if(typeof c!="string")return k(d,c),mt.add(async function(){const b=await ht(f,"temp_view/temp_view",c.map,c.reduce,!0,e);return ni(J(b,p).then(function(){return he(b,d)}),function(){return b.db.destroy()})}),mt.finish();{const b=c,v=kn(b),$=v[0],h=v[1],m=await f.get("_design/"+$);if(c=m.views&&m.views[h],!c)throw new Xn(`ddoc ${m._id} has no view named ${h}`);r(m,h),k(d,c);const _=await ht(f,b,c.map,c.reduce,!1,e);return d.stale==="ok"||d.stale==="update_after"?(d.stale==="update_after"&&Te(function(){J(_,p)}),he(_,d)):(await J(_,p),he(_,d))}}function _n(f,c,d){const p=this;typeof c=="function"&&(d=c,c={}),c=c?O(c):{},typeof f=="function"&&(f={map:f});const b=Promise.resolve().then(function(){return mn(p,f,c)});return qt(b,d),b}const Ke=ei(function(){const f=this;return typeof f._viewCleanup=="function"?L(f):ve(f)?gn(f):Ge(f)});return{query:_n,viewCleanup:Ke}}function $e(e,n){for(var t=e,r=0,i=n.length;r<i;r++){var o=n[r];if(t=t[o],!t)break}return t}function Jt(e,n,t){for(var r=0,i=n.length;r<i-1;r++){var o=n[r];e=e[o]=e[o]||{}}e[n[i-1]]=t}function cn(e,n){return e<n?-1:e>n?1:0}function ae(e){for(var n=[],t="",r=0,i=e.length;r<i;r++){var o=e[r];r>0&&e[r-1]==="\\"&&(o==="$"||o===".")?t=t.substring(0,t.length-1)+o:o==="."?(n.push(t),t=""):t+=o}return n.push(t),n}var ai=["$or","$nor","$not"];function Yn(e){return ai.indexOf(e)>-1}function q(e){return Object.keys(e)[0]}function ln(e){return e[q(e)]}function Ne(e){var n={},t={$or:!0,$nor:!0};return e.forEach(function(r){Object.keys(r).forEach(function(i){var o=r[i];if(typeof o!="object"&&(o={$eq:o}),Yn(i))if(o instanceof Array){if(t[i]){t[i]=!1,n[i]=o;return}var a=[];n[i].forEach(function(s){Object.keys(o).forEach(function(l){var w=o[l],y=Math.max(Object.keys(s).length,Object.keys(w).length),g=Ne([s,w]);Object.keys(g).length<=y||a.push(g)})}),n[i]=a}else n[i]=Ne([o]);else{var u=n[i]=n[i]||{};Object.keys(o).forEach(function(s){var l=o[s];if(s==="$gt"||s==="$gte")return ui(s,l,u);if(s==="$lt"||s==="$lte")return si(s,l,u);if(s==="$ne")return fi(l,u);if(s==="$eq")return ci(l,u);if(s==="$regex")return li(l,u);u[s]=l})}})}),n}function ui(e,n,t){typeof t.$eq<"u"||(typeof t.$gte<"u"?e==="$gte"?n>t.$gte&&(t.$gte=n):n>=t.$gte&&(delete t.$gte,t.$gt=n):typeof t.$gt<"u"?e==="$gte"?n>t.$gt&&(delete t.$gt,t.$gte=n):n>t.$gt&&(t.$gt=n):t[e]=n)}function si(e,n,t){typeof t.$eq<"u"||(typeof t.$lte<"u"?e==="$lte"?n<t.$lte&&(t.$lte=n):n<=t.$lte&&(delete t.$lte,t.$lt=n):typeof t.$lt<"u"?e==="$lte"?n<t.$lt&&(delete t.$lt,t.$lte=n):n<t.$lt&&(t.$lt=n):t[e]=n)}function fi(e,n){"$ne"in n?n.$ne.push(e):n.$ne=[e]}function ci(e,n){delete n.$gt,delete n.$gte,delete n.$lt,delete n.$lte,delete n.$ne,n.$eq=e}function li(e,n){"$regex"in n?n.$regex.push(e):n.$regex=[e]}function Gt(e){for(var n in e){if(Array.isArray(e))for(var t in e)e[t].$and&&(e[t]=Ne(e[t].$and));var r=e[n];typeof r=="object"&&Gt(r)}return e}function Kt(e,n){for(var t in e){t==="$and"&&(n=!0);var r=e[t];typeof r=="object"&&(n=Kt(r,n))}return n}function dn(e){var n=oe(e);Kt(n,!1)&&(n=Gt(n),"$and"in n&&(n=Ne(n.$and))),["$or","$nor"].forEach(function(a){a in n&&n[a].forEach(function(u){for(var s=Object.keys(u),l=0;l<s.length;l++){var w=s[l],y=u[w];(typeof y!="object"||y===null)&&(u[w]={$eq:y})}})}),"$not"in n&&(n.$not=Ne([n.$not]));for(var t=Object.keys(n),r=0;r<t.length;r++){var i=t[r],o=n[i];(typeof o!="object"||o===null)&&(o={$eq:o}),n[i]=o}return Ln(n),n}function Ln(e){Object.keys(e).forEach(function(n){var t=e[n];Array.isArray(t)?t.forEach(function(r){r&&typeof r=="object"&&Ln(r)}):n==="$ne"?e.$ne=[t]:n==="$regex"?e.$regex=[t]:t&&typeof t=="object"&&Ln(t)})}function Ht(e){function n(t){return e.map(function(r){var i=q(r),o=ae(i),a=$e(t,o);return a})}return function(t,r){var i=n(t.doc),o=n(r.doc),a=Q(i,o);return a!==0?a:cn(t.doc._id,r.doc._id)}}function Zn(e,n,t){if(e=e.filter(function(a){return ce(a.doc,n.selector,t)}),n.sort){var r=Ht(n.sort);e=e.sort(r),typeof n.sort[0]!="string"&&ln(n.sort[0])==="desc"&&(e=e.reverse())}if("limit"in n||"skip"in n){var i=n.skip||0,o=("limit"in n?n.limit:e.length)+i;e=e.slice(i,o)}return e}function ce(e,n,t){return t.every(function(r){var i=n[r],o=ae(r),a=$e(e,o);return Yn(r)?di(r,i,e):nn(i,e,o,a)})}function nn(e,n,t,r){return e?typeof e=="object"?Object.keys(e).every(function(i){var o=e[i];if(i.indexOf("$")===0)return $t(i,n,o,t,r);var a=ae(i);if(r===void 0&&typeof o!="object"&&a.length>0)return!1;var u=$e(r,a);return typeof o=="object"?nn(o,n,t,u):$t("$eq",n,o,a,u)}):e===r:!0}function di(e,n,t){return e==="$or"?n.some(function(r){return ce(t,r,Object.keys(r))}):e==="$not"?!ce(t,n,Object.keys(n)):!n.find(function(r){return ce(t,r,Object.keys(r))})}function $t(e,n,t,r,i){if(!bt[e])throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return bt[e](n,t,r,i)}function Ee(e){return typeof e<"u"&&e!==null}function ue(e){return typeof e<"u"}function vi(e,n){if(typeof e!="number"||parseInt(e,10)!==e)return!1;var t=n[0],r=n[1];return e%t===r}function wt(e,n){return n.some(function(t){return e instanceof Array?e.some(function(r){return Q(t,r)===0}):Q(t,e)===0})}function yi(e,n){return n.every(function(t){return e.some(function(r){return Q(t,r)===0})})}function pi(e,n){return e.length===n}function hi(e,n){var t=new RegExp(n);return t.test(e)}function gi(e,n){switch(n){case"null":return e===null;case"boolean":return typeof e=="boolean";case"number":return typeof e=="number";case"string":return typeof e=="string";case"array":return e instanceof Array;case"object":return{}.toString.call(e)==="[object Object]"}}var bt={$elemMatch:function(e,n,t,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.some(function(i){return ce(i,n,Object.keys(n))}):r.some(function(i){return nn(n,e,t,i)})},$allMatch:function(e,n,t,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.every(function(i){return ce(i,n,Object.keys(n))}):r.every(function(i){return nn(n,e,t,i)})},$eq:function(e,n,t,r){return ue(r)&&Q(r,n)===0},$gte:function(e,n,t,r){return ue(r)&&Q(r,n)>=0},$gt:function(e,n,t,r){return ue(r)&&Q(r,n)>0},$lte:function(e,n,t,r){return ue(r)&&Q(r,n)<=0},$lt:function(e,n,t,r){return ue(r)&&Q(r,n)<0},$exists:function(e,n,t,r){return n?ue(r):!ue(r)},$mod:function(e,n,t,r){return Ee(r)&&vi(r,n)},$ne:function(e,n,t,r){return n.every(function(i){return Q(r,i)!==0})},$in:function(e,n,t,r){return Ee(r)&&wt(r,n)},$nin:function(e,n,t,r){return Ee(r)&&!wt(r,n)},$size:function(e,n,t,r){return Ee(r)&&Array.isArray(r)&&pi(r,n)},$all:function(e,n,t,r){return Array.isArray(r)&&yi(r,n)},$regex:function(e,n,t,r){return Ee(r)&&typeof r=="string"&&n.every(function(i){return hi(r,i)})},$type:function(e,n,t,r){return gi(r,n)}};function Be(e,n){if(typeof n!="object")throw new Error("Selector error: expected a JSON object");n=dn(n);var t={doc:e},r=Zn([t],{selector:n},Object.keys(n));return r&&r.length===1}const mi=Object.freeze(Object.defineProperty({__proto__:null,compare:cn,createFieldSorter:Ht,filterInMemoryFields:Zn,getFieldFromDoc:$e,getKey:q,getValue:ln,isCombinationalField:Yn,massageSelector:dn,matchesSelector:Be,parseField:ae,rowFilter:ce,setFieldInDoc:Jt},Symbol.toStringTag,{value:"Module"}));function Xt(e){return e=oe(e),e.index||(e.index={}),["type","name","ddoc"].forEach(function(n){e.index[n]&&(e[n]=e.index[n],delete e.index[n])}),e.fields&&(e.index.fields=e.fields,delete e.fields),e.type||(e.type="json"),e}function _i(e,n,t){var r="",i=n,o=!0;if(["$in","$nin","$or","$and","$mod","$nor","$all"].indexOf(e)!==-1&&(Array.isArray(n)||(r="Query operator "+e+" must be an array.")),["$not","$elemMatch","$allMatch"].indexOf(e)!==-1&&(!Array.isArray(n)&&typeof n=="object"&&n!==null||(r="Query operator "+e+" must be an object.")),e==="$mod"&&Array.isArray(n))if(n.length!==2)r="Query operator $mod must be in the format [divisor, remainder], where divisor and remainder are both integers.";else{var a=n[0],u=n[1];a===0&&(r="Query operator $mod's divisor cannot be 0, cannot divide by zero.",o=!1),(typeof a!="number"||parseInt(a,10)!==a)&&(r="Query operator $mod's divisor is not an integer.",i=a),parseInt(u,10)!==u&&(r="Query operator $mod's remainder is not an integer.",i=u)}if(e==="$exists"&&typeof n!="boolean"&&(r="Query operator $exists must be a boolean."),e==="$type"){var s=["null","boolean","number","string","array","object"],l='"'+s.slice(0,s.length-1).join('", "')+'", or "'+s[s.length-1]+'"';(typeof n!="string"||s.indexOf(n)==-1)&&(r="Query operator $type must be a string. Supported values: "+l+".")}if(e==="$size"&&parseInt(n,10)!==n&&(r="Query operator $size must be a integer."),e==="$regex"&&typeof n!="string"&&(t?r="Query operator $regex must be a string.":n instanceof RegExp||(r="Query operator $regex must be a string or an instance of a javascript regular expression.")),r){if(o){var w=i===null?" ":Array.isArray(i)?" array":" "+typeof i,y=typeof i=="object"&&i!==null?JSON.stringify(i,null,"	"):i;r+=" Received"+w+": "+y}throw new Error(r)}}var $i=["$all","$allMatch","$and","$elemMatch","$exists","$in","$mod","$nin","$nor","$not","$or","$regex","$size","$type"],wi=["$in","$nin","$mod","$all"],bi=["$eq","$gt","$gte","$lt","$lte"];function tn(e,n){if(Array.isArray(e))for(var t of e)typeof t=="object"&&a!==null&&tn(t,n);else for(var r=Object.keys(e),i=0;i<r.length;i++){var o=r[i],a=e[o];$i.indexOf(o)!==-1&&_i(o,a,n),bi.indexOf(o)===-1&&wi.indexOf(o)===-1&&typeof a=="object"&&a!==null&&tn(a,n)}}function Re(e,n,t,r){var i,o;t.headers=new Ve({"Content-type":"application/json"}),e.fetch(n,t).then(function(a){return i=a.status,o=a.ok,a.json()}).then(function(a){if(o)r(null,a);else{a.status=i;var u=In(a);r(u)}}).catch(r)}function ki(e,n,t){n=Xt(n),Re(e,"_index",{method:"POST",body:JSON.stringify(n)},t)}function xi(e,n,t){tn(n.selector,!0),Re(e,"_find",{method:"POST",body:JSON.stringify(n)},t)}function Oi(e,n,t){Re(e,"_explain",{method:"POST",body:JSON.stringify(n)},t)}function Ei(e,n){Re(e,"_index",{method:"GET"},n)}function Ai(e,n,t){var r=n.ddoc,i=n.type||"json",o=n.name;if(!r)return t(new Error("you must provide an index's ddoc"));if(!o)return t(new Error("you must provide an index's name"));var a="_index/"+[r,i,o].map(encodeURIComponent).join("/");Re(e,a,{method:"DELETE"},t)}function Ue(e){return function(...n){var t=n.pop(),r=e.apply(this,n);return Si(r,t),r}}function Si(e,n){return e.then(function(t){Te(function(){n(null,t)})},function(t){Te(function(){n(t)})}),e}var Vn=function(...e){for(var n=[],t=0,r=e.length;t<r;t++){var i=e[t];Array.isArray(i)?n=n.concat(Vn.apply(null,i)):n.push(i)}return n};function Dn(e){for(var n={},t=0,r=e.length;t<r;t++)n=Hn(n,e[t]);return n}function Ii(e,n){for(var t={},r=0,i=n.length;r<i;r++){var o=ae(n[r]),a=$e(e,o);typeof a<"u"&&Jt(t,o,a)}return t}function Wt(e,n){for(var t=0,r=Math.min(e.length,n.length);t<r;t++)if(e[t]!==n[t])return!1;return!0}function ji(e,n){return e.length>n.length?!1:Wt(e,n)}function Fi(e,n){e=e.slice();for(var t=0,r=n.length;t<r;t++){var i=n[t];if(!e.length)break;var o=e.indexOf(i);if(o===-1)return!1;e.splice(o,1)}return!0}function Ti(e){for(var n={},t=0,r=e.length;t<r;t++)n[e[t]]=!0;return n}function Ci(e,n){for(var t=null,r=-1,i=0,o=e.length;i<o;i++){var a=e[i],u=n(a);u>r&&(r=u,t=a)}return t}function kt(e,n){if(e.length!==n.length)return!1;for(var t=0,r=e.length;t<r;t++)if(e[t]!==n[t])return!1;return!0}function Ni(e){for(var n={},t=0;t<e.length;t++)n["$"+e[t]]=!0;return Object.keys(n).map(function(r){return r.substring(1)})}function Pi(e,n,t){return function(r){if(!(t&&!Be(r,t))){for(var i=[],o=0,a=e.length;o<a;o++){for(var u=ae(e[o]),s=r,l=0,w=u.length;l<w;l++){var y=u[l];if(s=s[y],typeof s>"u")return}i.push(s)}n(i)}}}function Li(e,n,t){var r=ae(e);return function(i){if(!(t&&!Be(i,t))){for(var o=i,a=0,u=r.length;a<u;a++){var s=r[a];if(o=o[s],typeof o>"u")return}n(o)}}}function Bi(e,n,t){return function(r){t&&!Be(r,t)||n(r[e])}}function Ri(e,n,t){return function(r){if(!(t&&!Be(r,t))){for(var i=[],o=0,a=e.length;o<a;o++)i.push(r[e[o]]);n(i)}}}function Ui(e){for(var n=0,t=e.length;n<t;n++){var r=e[n];if(r.indexOf(".")!==-1)return!1}return!0}function zi(e,n,t){var r=Ui(e),i=e.length===1;return r?i?Bi(e[0],n,t):Ri(e,n,t):i?Li(e[0],n,t):Pi(e,n,t)}function Qi(e,n){const t=Object.keys(e.fields),r=e.partial_filter_selector;return zi(t,n,r)}function Mi(){throw new Error("reduce not supported")}function qi(e,n){var t=e.views[n];if(!t.map||!t.map.fields)throw new Error("ddoc "+e._id+" with view "+n+" doesn't have map.fields defined. maybe it wasn't created by this plugin?")}var xn=oi("indexes",Qi,Mi,qi);function et(e){return e._customFindAbstractMapper?{query:function(t,r){var i=xn.query.bind(this);return e._customFindAbstractMapper.query.call(this,t,r,i)},viewCleanup:function(){var t=xn.viewCleanup.bind(this);return e._customFindAbstractMapper.viewCleanup.call(this,t)}}:xn}function Ji(e){if(!Array.isArray(e))throw new Error("invalid sort json - should be an array");return e.map(function(n){if(typeof n=="string"){var t={};return t[n]="asc",t}else return n})}function Gi(e){var n=[];return typeof e=="string"?n.push(e):n=e,n.map(function(t){return t.replace("_design/","")})}function Yt(e){return e.fields=e.fields.map(function(n){if(typeof n=="string"){var t={};return t[n]="asc",t}return n}),e.partial_filter_selector&&(e.partial_filter_selector=dn(e.partial_filter_selector)),e}function Ki(e,n){for(var t=[],r=0;r<n.def.fields.length;r++){var i=q(n.def.fields[r]);t.push($e(e,ae(i)))}return t}function Hi(e,n,t){for(var r=t.def.fields,i=0,o=e.length;i<o;i++){var a=e[i],u=Ki(a.doc,t);if(r.length===1)u=u[0];else for(;u.length>n.length;)u.pop();if(Math.abs(Q(u,n))>0)break}return i>0?e.slice(i):e}function Xi(e){var n=oe(e);return delete n.startkey,delete n.endkey,delete n.inclusive_start,delete n.inclusive_end,"endkey"in e&&(n.startkey=e.endkey),"startkey"in e&&(n.endkey=e.startkey),"inclusive_start"in e&&(n.inclusive_end=e.inclusive_start),"inclusive_end"in e&&(n.inclusive_start=e.inclusive_end),n}function Wi(e){var n=e.fields.filter(function(t){return ln(t)==="asc"});if(n.length!==0&&n.length!==e.fields.length)throw new Error("unsupported mixed sorting")}function Yi(e,n){if(n.defaultUsed&&e.sort){var t=e.sort.filter(function(r){return Object.keys(r)[0]!=="_id"}).map(function(r){return Object.keys(r)[0]});if(t.length>0)throw new Error('Cannot sort on field(s) "'+t.join(",")+'" when using the default index')}n.defaultUsed}function Zi(e){if(typeof e.selector!="object")throw new Error("you must provide a selector when you find()")}function Vi(e,n){var t=Object.keys(e),r=n?n.map(q):[],i;return t.length>=r.length?i=t:i=r,r.length===0?{fields:i}:(i=i.sort(function(o,a){var u=r.indexOf(o);u===-1&&(u=Number.MAX_VALUE);var s=r.indexOf(a);return s===-1&&(s=Number.MAX_VALUE),u<s?-1:u>s?1:0}),{fields:i,sortOrder:n.map(q)})}function Di(e,n){n=Xt(n);var t=oe(n.index);n.index=Yt(n.index),Wi(n.index);var r;function i(){return r||(r=Qt(JSON.stringify(n)))}var o=n.name||"idx-"+i(),a=n.ddoc||"idx-"+i(),u="_design/"+a,s=!1,l=!1;function w(y){return y._rev&&y.language!=="query"&&(s=!0),y.language="query",y.views=y.views||{},l=!!y.views[o],l?!1:(y.views[o]={map:{fields:Dn(n.index.fields),partial_filter_selector:n.index.partial_filter_selector},reduce:"_count",options:{def:t}},y)}return e.constructor.emit("debug",["find","creating index",u]),fn(e,u,w).then(function(){if(s)throw new Error('invalid language for ddoc with id "'+u+'" (should be "query")')}).then(function(){var y=a+"/"+o;return et(e).query.call(e,y,{limit:0,reduce:!1}).then(function(){return{id:u,name:o,result:l?"exists":"created"}})})}function Zt(e){return e.allDocs({startkey:"_design/",endkey:"_design/￿",include_docs:!0}).then(function(n){var t={indexes:[{ddoc:null,name:"_all_docs",type:"special",def:{fields:[{_id:"asc"}]}}]};return t.indexes=Vn(t.indexes,n.rows.filter(function(r){return r.doc.language==="query"}).map(function(r){var i=r.doc.views!==void 0?Object.keys(r.doc.views):[];return i.map(function(o){var a=r.doc.views[o];return{ddoc:r.id,name:o,type:"json",def:Yt(a.options.def)}})})),t.indexes.sort(function(r,i){return cn(r.name,i.name)}),t.total_rows=t.indexes.length,t})}var rn=null,Bn={"￿":{}};const eo={queryOpts:{limit:0,startkey:Bn,endkey:rn},inMemoryFields:[]};function no(e,n){for(var t=e.def.fields.map(q),r=0,i=t.length;r<i;r++){var o=t[r];if(n===o)return!0}return!1}function to(e,n){var t=e[n],r=q(t);return r!=="$eq"}function Vt(e,n){var t=n.def.fields.map(q);return e.slice().sort(function(r,i){var o=t.indexOf(r),a=t.indexOf(i);return o===-1&&(o=Number.MAX_VALUE),a===-1&&(a=Number.MAX_VALUE),cn(o,a)})}function ro(e,n,t){t=Vt(t,e);for(var r=!1,i=0,o=t.length;i<o;i++){var a=t[i];if(r||!no(e,a))return t.slice(i);i<o-1&&to(n,a)&&(r=!0)}return[]}function io(e){var n=[];return Object.keys(e).forEach(function(t){var r=e[t];Object.keys(r).forEach(function(i){i==="$ne"&&n.push(t)})}),n}function oo(e,n,t,r){var i=Vn(e,ro(n,t,r),io(t));return Vt(Ni(i),n)}function ao(e,n,t){if(n){var r=ji(n,e),i=Wt(t,e);return r&&i}return Fi(t,e)}var uo=["$eq","$gt","$gte","$lt","$lte"];function Dt(e){return uo.indexOf(e)===-1}function so(e,n){var t=e[0],r=n[t];if(typeof r>"u")return!0;var i=Object.keys(r).length===1&&q(r)==="$ne";return!i}function fo(e,n,t,r){var i=e.def.fields.map(q),o=ao(i,n,t);return o?so(i,r):!1}function co(e,n,t,r){return r.filter(function(i){return fo(i,t,n,e)})}function lo(e,n,t,r,i){var o=co(e,n,t,r);if(o.length===0){if(i)throw{error:"no_usable_index",message:"There is no index available for this selector."};var a=r[0];return a.defaultUsed=!0,a}if(o.length===1&&!i)return o[0];var u=Ti(n);function s(g){for(var O=g.def.fields.map(q),j=0,k=0,E=O.length;k<E;k++){var x=O[k];u[x]&&j++}return j}if(i){var l="_design/"+i[0],w=i.length===2?i[1]:!1,y=o.find(function(g){return!!(w&&g.ddoc===l&&w===g.name||g.ddoc===l)});if(!y)throw{error:"unknown_error",message:"Could not find that index or could not use that index for the query"};return y}return Ci(o,s)}function vo(e,n){switch(e){case"$eq":return{key:n};case"$lte":return{endkey:n};case"$gte":return{startkey:n};case"$lt":return{endkey:n,inclusive_end:!1};case"$gt":return{startkey:n,inclusive_start:!1}}return{startkey:rn}}function yo(e,n){var t=q(n.def.fields[0]),r=e[t]||{},i=[],o=Object.keys(r),a;return o.forEach(function(u){Dt(u)&&i.push(t);var s=r[u],l=vo(u,s);a?a=Dn([a,l]):a=l}),{queryOpts:a,inMemoryFields:i}}function po(e,n){switch(e){case"$eq":return{startkey:n,endkey:n};case"$lte":return{endkey:n};case"$gte":return{startkey:n};case"$lt":return{endkey:n,inclusive_end:!1};case"$gt":return{startkey:n,inclusive_start:!1}}}function ho(e,n){var t=n.def.fields.map(q),r=[],i=[],o=[],a,u;function s(pe){a!==!1&&i.push(rn),u!==!1&&o.push(Bn),r=t.slice(pe)}for(var l=0,w=t.length;l<w;l++){var y=t[l],g=e[y];if(!g||!Object.keys(g).length){s(l);break}else if(Object.keys(g).some(Dt)){s(l);break}else if(l>0){var O="$gt"in g||"$gte"in g||"$lt"in g||"$lte"in g,j=Object.keys(e[t[l-1]]),k=kt(j,["$eq"]),E=kt(j,Object.keys(g)),x=O&&!k&&!E;if(x){s(l);break}}for(var L=Object.keys(g),R=null,Z=0;Z<L.length;Z++){var X=L[Z],D=g[X],ee=po(X,D);R?R=Dn([R,ee]):R=ee}i.push("startkey"in R?R.startkey:rn),o.push("endkey"in R?R.endkey:Bn),"inclusive_start"in R&&(a=R.inclusive_start),"inclusive_end"in R&&(u=R.inclusive_end)}var J={startkey:i,endkey:o};return typeof a<"u"&&(J.inclusive_start=a),typeof u<"u"&&(J.inclusive_end=u),{queryOpts:J,inMemoryFields:r}}function go(e){return Object.keys(e).map(function(t){return e[t]}).some(function(t){return typeof t=="object"&&Object.keys(t).length===0})}function mo(e){return{queryOpts:{startkey:null},inMemoryFields:[Object.keys(e)]}}function _o(e,n){return n.defaultUsed?mo(e):n.def.fields.length===1?yo(e,n):ho(e,n)}function $o(e,n){var t=e.selector,r=e.sort;if(go(t))return Hn({},eo,{index:n[0]});var i=Vi(t,r),o=i.fields,a=i.sortOrder,u=lo(t,o,a,n,e.use_index),s=_o(t,u),l=s.queryOpts,w=s.inMemoryFields,y=oo(w,u,t,o),g={queryOpts:l,index:u,inMemoryFields:y};return g}function wo(e){return e.ddoc.substring(8)+"/"+e.name}function bo(e,n){var t=oe(n);return t.descending?("endkey"in t&&typeof t.endkey!="string"&&(t.endkey=""),"startkey"in t&&typeof t.startkey!="string"&&(t.limit=0)):("startkey"in t&&typeof t.startkey!="string"&&(t.startkey=""),"endkey"in t&&typeof t.endkey!="string"&&(t.limit=0)),"key"in t&&typeof t.key!="string"&&(t.limit=0),t.limit>0&&t.indexes_count&&(t.original_limit=t.limit,t.limit+=t.indexes_count),e.allDocs(t).then(function(r){return r.rows=r.rows.filter(function(i){return!/^_design\//.test(i.id)}),t.original_limit&&(t.limit=t.original_limit),r.rows=r.rows.slice(0,t.limit),r})}function er(e,n,t){return n.selector&&(tn(n.selector,!1),n.selector=dn(n.selector)),n.sort&&(n.sort=Ji(n.sort)),n.use_index&&(n.use_index=Gi(n.use_index)),Zi(n),Zt(e).then(function(r){e.constructor.emit("debug",["find","planning query",n]);var i=$o(n,r.indexes);e.constructor.emit("debug",["find","query plan",i]);var o=i.index;Yi(n,o);var a=Hn({include_docs:!0,reduce:!1,indexes_count:r.total_rows},i.queryOpts);if("startkey"in a&&"endkey"in a&&Q(a.startkey,a.endkey)>0)return{docs:[]};var u=n.sort&&typeof n.sort[0]!="string"&&ln(n.sort[0])==="desc";return u&&(a.descending=!0,a=Xi(a)),i.inMemoryFields.length||("limit"in n&&(a.limit=n.limit),"skip"in n&&(a.skip=n.skip)),t?Promise.resolve(i,a):Promise.resolve().then(function(){if(o.name==="_all_docs")return bo(e,a);var s=wo(o);return et(e).query.call(e,s,a)}).then(function(s){a.inclusive_start===!1&&(s.rows=Hi(s.rows,a.startkey,o)),i.inMemoryFields.length&&(s.rows=Zn(s.rows,n,i.inMemoryFields));var l={docs:s.rows.map(function(w){var y=w.doc;return n.fields?Ii(y,n.fields):y})};return o.defaultUsed&&(l.warning="No matching index found, create an index to optimize query time."),l})})}function ko(e,n){return er(e,n,!0).then(function(t){return{dbname:e.name,index:t.index,selector:n.selector,range:{start_key:t.queryOpts.startkey,end_key:t.queryOpts.endkey},opts:{use_index:n.use_index||[],bookmark:"nil",limit:n.limit,skip:n.skip,sort:n.sort||{},fields:n.fields,conflicts:!1,r:[49]},limit:n.limit,skip:n.skip||0,fields:n.fields}})}function xo(e,n){if(!n.ddoc)throw new Error("you must supply an index.ddoc when deleting");if(!n.name)throw new Error("you must supply an index.name when deleting");var t=n.ddoc,r=n.name;function i(o){return Object.keys(o.views).length===1&&o.views[r]?{_id:t,_deleted:!0}:(delete o.views[r],o)}return fn(e,t,i).then(function(){return et(e).viewCleanup.apply(e)}).then(function(){return{ok:!0}})}var Oo=Ue(Di),Eo=Ue(er),Ao=Ue(ko),So=Ue(Zt),Io=Ue(xo),we={};we.createIndex=Le(function(e,n){if(typeof e!="object")return n(new Error("you must provide an index to create"));var t=ve(this)?ki:Oo;t(this,e,n)});we.find=Le(function(e,n){if(typeof n>"u"&&(n=e,e=void 0),typeof e!="object")return n(new Error("you must provide search parameters to find()"));var t=ve(this)?xi:Eo;t(this,e,n)});we.explain=Le(function(e,n){if(typeof n>"u"&&(n=e,e=void 0),typeof e!="object")return n(new Error("you must provide search parameters to explain()"));var t=ve(this)?Oi:Ao;t(this,e,n)});we.getIndexes=Le(function(e){var n=ve(this)?Ei:So;n(this,e)});we.deleteIndex=Le(function(e,n){if(typeof e!="object")return n(new Error("you must provide an index to delete"));var t=ve(this)?Ai:Io;t(this,e,n)});var nr={},nt={};function jo(e,n,t){for(var r="",i=t-e.length;r.length<i;)r+=n;return r}function Fo(e,n,t){var r=jo(e,n,t);return r+e}var tr=-324,Rn=3,Un="";function H(e,n){if(e===n)return 0;e=_e(e),n=_e(n);var t=zn(e),r=zn(n);if(t-r!==0)return t-r;switch(typeof e){case"number":return e-n;case"boolean":return e<n?-1:1;case"string":return Bo(e,n)}return Array.isArray(e)?Lo(e,n):Ro(e,n)}function _e(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var n=e;if(Array.isArray(e)){var t=e.length;e=new Array(t);for(var r=0;r<t;r++)e[r]=_e(n[r])}else{if(e instanceof Date)return e.toJSON();if(e!==null){e={};for(var i in n)if(n.hasOwnProperty(i)){var o=n[i];typeof o<"u"&&(e[i]=_e(o))}}}}return e}function To(e){if(e!==null)switch(typeof e){case"boolean":return e?1:0;case"number":return Uo(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var n=Array.isArray(e),t=n?e:Object.keys(e),r=-1,i=t.length,o="";if(n)for(;++r<i;)o+=De(t[r]);else for(;++r<i;){var a=t[r];o+=De(a)+De(e[a])}return o}return""}function De(e){var n="\0";return e=_e(e),zn(e)+Un+To(e)+n}function Co(e,n){var t=n,r,i=e[n]==="1";if(i)r=0,n++;else{var o=e[n]==="0";n++;var a="",u=e.substring(n,n+Rn),s=parseInt(u,10)+tr;for(o&&(s=-s),n+=Rn;;){var l=e[n];if(l==="\0")break;a+=l,n++}a=a.split("."),a.length===1?r=parseInt(a,10):r=parseFloat(a[0]+"."+a[1]),o&&(r=r-10),s!==0&&(r=parseFloat(r+"e"+s))}return{num:r,length:n-t}}function No(e,n){var t=e.pop();if(n.length){var r=n[n.length-1];t===r.element&&(n.pop(),r=n[n.length-1]);var i=r.element,o=r.index;if(Array.isArray(i))i.push(t);else if(o===e.length-2){var a=e.pop();i[a]=t}else e.push(t)}}function Po(e){for(var n=[],t=[],r=0;;){var i=e[r++];if(i==="\0"){if(n.length===1)return n.pop();No(n,t);continue}switch(i){case"1":n.push(null);break;case"2":n.push(e[r]==="1"),r++;break;case"3":var o=Co(e,r);n.push(o.num),r+=o.length;break;case"4":for(var a="";;){var u=e[r];if(u==="\0")break;a+=u,r++}a=a.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),n.push(a);break;case"5":var s={element:[],index:n.length};n.push(s.element),t.push(s);break;case"6":var l={element:{},index:n.length};n.push(l.element),t.push(l);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}}}function Lo(e,n){for(var t=Math.min(e.length,n.length),r=0;r<t;r++){var i=H(e[r],n[r]);if(i!==0)return i}return e.length===n.length?0:e.length>n.length?1:-1}function Bo(e,n){return e===n?0:e>n?1:-1}function Ro(e,n){for(var t=Object.keys(e),r=Object.keys(n),i=Math.min(t.length,r.length),o=0;o<i;o++){var a=H(t[o],r[o]);if(a!==0||(a=H(e[t[o]],n[r[o]]),a!==0))return a}return t.length===r.length?0:t.length>r.length?1:-1}function zn(e){var n=["boolean","number","string","object"],t=n.indexOf(typeof e);if(~t)return e===null?1:Array.isArray(e)?5:t<3?t+2:t+3;if(Array.isArray(e))return 5}function Uo(e){if(e===0)return"1";var n=e.toExponential().split(/e\+?/),t=parseInt(n[1],10),r=e<0,i=r?"0":"2",o=(r?-t:t)-tr,a=Fo(o.toString(),"0",Rn);i+=Un+a;var u=Math.abs(parseFloat(n[0]));r&&(u=10-u);var s=u.toFixed(20);return s=s.replace(/\.?0+$/,""),i+=Un+s,i}const zo=Object.freeze(Object.defineProperty({__proto__:null,collate:H,normalizeKey:_e,parseIndexableString:Po,toIndexableString:De},Symbol.toStringTag,{value:"Module"})),rr=Bt(zo);var xt=Y.MutationObserver||Y.WebKitMutationObserver,Se;if(xt){var Ot=0,Qo=new xt(Ye),Et=Y.document.createTextNode("");Qo.observe(Et,{characterData:!0}),Se=function(){Et.data=Ot=++Ot%2}}else if(!Y.setImmediate&&typeof Y.MessageChannel<"u"){var At=new Y.MessageChannel;At.port1.onmessage=Ye,Se=function(){At.port2.postMessage(0)}}else"document"in Y&&"onreadystatechange"in Y.document.createElement("script")?Se=function(){var e=Y.document.createElement("script");e.onreadystatechange=function(){Ye(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},Y.document.documentElement.appendChild(e)}:Se=function(){setTimeout(Ye,0)};var Qn,Ie=[];function Ye(){Qn=!0;for(var e,n,t=Ie.length;t;){for(n=Ie,Ie=[],e=-1;++e<t;)n[e]();t=Ie.length}Qn=!1}var ir=Mo;function Mo(e){Ie.push(e)===1&&!Qn&&Se()}const qo=an(ir);var Jo=ir;function be(){}var M={},or=["REJECTED"],Mn=["FULFILLED"],ar=["PENDING"];function ke(e){if(typeof e!="function")throw new TypeError("resolver must be a function");this.state=ar,this.queue=[],this.outcome=void 0,e!==be&&ur(this,e)}ke.prototype.catch=function(e){return this.then(null,e)};ke.prototype.then=function(e,n){if(typeof e!="function"&&this.state===Mn||typeof n!="function"&&this.state===or)return this;var t=new this.constructor(be);if(this.state!==ar){var r=this.state===Mn?e:n;tt(t,r,this.outcome)}else this.queue.push(new ze(t,e,n));return t};function ze(e,n,t){this.promise=e,typeof n=="function"&&(this.onFulfilled=n,this.callFulfilled=this.otherCallFulfilled),typeof t=="function"&&(this.onRejected=t,this.callRejected=this.otherCallRejected)}ze.prototype.callFulfilled=function(e){M.resolve(this.promise,e)};ze.prototype.otherCallFulfilled=function(e){tt(this.promise,this.onFulfilled,e)};ze.prototype.callRejected=function(e){M.reject(this.promise,e)};ze.prototype.otherCallRejected=function(e){tt(this.promise,this.onRejected,e)};function tt(e,n,t){Jo(function(){var r;try{r=n(t)}catch(i){return M.reject(e,i)}r===e?M.reject(e,new TypeError("Cannot resolve promise with itself")):M.resolve(e,r)})}M.resolve=function(e,n){var t=sr(Go,n);if(t.status==="error")return M.reject(e,t.value);var r=t.value;if(r)ur(e,r);else{e.state=Mn,e.outcome=n;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(n)}return e};M.reject=function(e,n){e.state=or,e.outcome=n;for(var t=-1,r=e.queue.length;++t<r;)e.queue[t].callRejected(n);return e};function Go(e){var n=e&&e.then;if(e&&(typeof e=="object"||typeof e=="function")&&typeof n=="function")return function(){n.apply(e,arguments)}}function ur(e,n){var t=!1;function r(u){t||(t=!0,M.reject(e,u))}function i(u){t||(t=!0,M.resolve(e,u))}function o(){n(i,r)}var a=sr(o);a.status==="error"&&r(a.value)}function sr(e,n){var t={};try{t.value=e(n),t.status="success"}catch(r){t.status="error",t.value=r}return t}ke.resolve=Ko;function Ko(e){return e instanceof this?e:M.resolve(new this(be),e)}ke.reject=Ho;function Ho(e){var n=new this(be);return M.reject(n,e)}ke.all=Xo;function Xo(e){var n=this;if(Object.prototype.toString.call(e)!=="[object Array]")return this.reject(new TypeError("must be an array"));var t=e.length,r=!1;if(!t)return this.resolve([]);for(var i=new Array(t),o=0,a=-1,u=new this(be);++a<t;)s(e[a],a);return u;function s(l,w){n.resolve(l).then(y,function(g){r||(r=!0,M.reject(u,g))});function y(g){i[w]=g,++o===t&&!r&&(r=!0,M.resolve(u,i))}}}ke.race=Wo;function Wo(e){var n=this;if(Object.prototype.toString.call(e)!=="[object Array]")return this.reject(new TypeError("must be an array"));var t=e.length,r=!1;if(!t)return this.resolve([]);for(var i=-1,o=new this(be);++i<t;)a(e[i]);return o;function a(u){n.resolve(u).then(function(s){r||(r=!0,M.resolve(o,s))},function(s){r||(r=!0,M.reject(o,s))})}}function vn(e){return"$"+e}function Yo(e){return e.substring(1)}function ye(){this._store={}}ye.prototype.get=function(e){var n=vn(e);return this._store[n]};ye.prototype.set=function(e,n){var t=vn(e);return this._store[t]=n,!0};ye.prototype.has=function(e){var n=vn(e);return n in this._store};ye.prototype.delete=function(e){var n=vn(e),t=n in this._store;return delete this._store[n],t};ye.prototype.forEach=function(e){for(var n=Object.keys(this._store),t=0,r=n.length;t<r;t++){var i=n[t],o=this._store[i];i=Yo(i),e(o,i)}};Object.defineProperty(ye.prototype,"size",{get:function(){return Object.keys(this._store).length}});function yn(e){if(this._store=new ye,e&&Array.isArray(e))for(var n=0,t=e.length;n<t;n++)this.add(e[n])}yn.prototype.add=function(e){return this._store.set(e,!0)};yn.prototype.has=function(e){return this._store.has(e)};yn.prototype.forEach=function(e){this._store.forEach(function(n,t){e(t)})};Object.defineProperty(yn.prototype,"size",{get:function(){return this._store.size}});var qn={exports:{}};typeof Object.create=="function"?qn.exports=function(n,t){n.super_=t,n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}})}:qn.exports=function(n,t){n.super_=t;var r=function(){};r.prototype=t.prototype,n.prototype=new r,n.prototype.constructor=n};var Zo=qn.exports;const fr=an(Zo);fr(C,Error);function C(e,n,t){Error.call(this,t),this.status=e,this.name=n,this.message=t,this.error=!0}C.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};new C(401,"unauthorized","Name or password is incorrect.");new C(400,"bad_request","Missing JSON list of 'docs'");new C(404,"not_found","missing");new C(409,"conflict","Document update conflict");new C(400,"bad_request","_id field must contain a string");new C(412,"missing_id","_id is required for puts");new C(400,"bad_request","Only reserved document ids may start with underscore.");new C(412,"precondition_failed","Database not open");new C(500,"unknown_error","Database encountered an unknown error");new C(500,"badarg","Some query argument is invalid");new C(400,"invalid_request","Request was invalid");new C(400,"query_parse_error","Some query parameter is invalid");new C(500,"doc_validation","Bad special document member");new C(400,"bad_request","Something wrong with the request");new C(400,"bad_request","Document must be a JSON object");new C(404,"not_found","Database not found");new C(500,"indexed_db_went_bad","unknown");new C(500,"web_sql_went_bad","unknown");new C(500,"levelDB_went_went_bad","unknown");new C(403,"forbidden","Forbidden by design doc validate_doc_update function");new C(400,"bad_request","Invalid rev format");new C(412,"file_exists","The database could not be created, the file already exists.");new C(412,"missing_stub","A pre-existing attachment stub wasn't found");new C(413,"invalid_url","Provided URL is invalid");var Jn={exports:{}},St=typeof crypto<"u"&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&msCrypto.getRandomValues.bind(msCrypto);if(St){var It=new Uint8Array(16);Jn.exports=function(){return St(It),It}}else{var jt=new Array(16);Jn.exports=function(){for(var n=0,t;n<16;n++)n&3||(t=Math.random()*4294967296),jt[n]=t>>>((n&3)<<3)&255;return jt}}var cr=Jn.exports,lr=[];for(var Ze=0;Ze<256;++Ze)lr[Ze]=(Ze+256).toString(16).substr(1);function Vo(e,n){var t=n||0,r=lr;return r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]+"-"+r[e[t++]]+r[e[t++]]+"-"+r[e[t++]]+r[e[t++]]+"-"+r[e[t++]]+r[e[t++]]+"-"+r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]+r[e[t++]]}var dr=Vo,Do=cr,ea=dr,Ft,On,En=0,An=0;function na(e,n,t){var r=n&&t||0,i=n||[];e=e||{};var o=e.node||Ft,a=e.clockseq!==void 0?e.clockseq:On;if(o==null||a==null){var u=Do();o==null&&(o=Ft=[u[0]|1,u[1],u[2],u[3],u[4],u[5]]),a==null&&(a=On=(u[6]<<8|u[7])&16383)}var s=e.msecs!==void 0?e.msecs:new Date().getTime(),l=e.nsecs!==void 0?e.nsecs:An+1,w=s-En+(l-An)/1e4;if(w<0&&e.clockseq===void 0&&(a=a+1&16383),(w<0||s>En)&&e.nsecs===void 0&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");En=s,An=l,On=a,s+=122192928e5;var y=((s&268435455)*1e4+l)%4294967296;i[r++]=y>>>24&255,i[r++]=y>>>16&255,i[r++]=y>>>8&255,i[r++]=y&255;var g=s/4294967296*1e4&268435455;i[r++]=g>>>8&255,i[r++]=g&255,i[r++]=g>>>24&15|16,i[r++]=g>>>16&255,i[r++]=a>>>8|128,i[r++]=a&255;for(var O=0;O<6;++O)i[r+O]=o[O];return n||ea(i)}var ta=na,ra=cr,ia=dr;function oa(e,n,t){var r=n&&t||0;typeof e=="string"&&(n=e==="binary"?new Array(16):null,e=null),e=e||{};var i=e.random||(e.rng||ra)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,n)for(var o=0;o<16;++o)n[r+o]=i[o];return n||ia(i)}var aa=oa,ua=ta,vr=aa,rt=vr;rt.v1=ua;rt.v4=vr;var sa=rt;const fa=an(sa);function ca(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer||typeof Blob<"u"&&e instanceof Blob}function la(e){if(typeof e.slice=="function")return e.slice(0);var n=new ArrayBuffer(e.byteLength),t=new Uint8Array(n),r=new Uint8Array(e);return t.set(r),n}function da(e){if(e instanceof ArrayBuffer)return la(e);var n=e.size,t=e.type;return typeof e.slice=="function"?e.slice(0,n,t):e.webkitSlice(0,n,t)}var yr=Function.prototype.toString,va=yr.call(Object);function ya(e){var n=Object.getPrototypeOf(e);if(n===null)return!0;var t=n.constructor;return typeof t=="function"&&t instanceof t&&yr.call(t)==va}function Gn(e){var n,t,r;if(!e||typeof e!="object")return e;if(Array.isArray(e)){for(n=[],t=0,r=e.length;t<r;t++)n[t]=Gn(e[t]);return n}if(e instanceof Date)return e.toISOString();if(ca(e))return da(e);if(!ya(e))return e;n={};for(t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var i=Gn(e[t]);typeof i<"u"&&(n[t]=i)}return n}function pa(e,n){for(var t={},r=0,i=n.length;r<i;r++){var o=n[r];o in e&&(t[o]=e[o])}return t}function it(){return typeof chrome<"u"&&typeof chrome.storage<"u"&&typeof chrome.storage.local<"u"}var en;if(it())en=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),en=!!localStorage.getItem("_pouch_check_localstorage")}catch{en=!1}function pr(){return en}fr(Qe,un.EventEmitter);function ha(e){it()?chrome.storage.onChanged.addListener(function(n){n.db_name!=null&&e.emit(n.dbName.newValue)}):pr()&&(typeof addEventListener<"u"?addEventListener("storage",function(n){e.emit(n.key)}):window.attachEvent("storage",function(n){e.emit(n.key)}))}function Qe(){un.EventEmitter.call(this),this._listeners={},ha(this)}Qe.prototype.addListener=function(e,n,t,r){if(this._listeners[n])return;var i=this,o=!1;function a(){if(!i._listeners[n])return;if(o){o="waiting";return}o=!0;var u=pa(r,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);function s(){o=!1}t.changes(u).on("change",function(l){l.seq>r.since&&!r.cancelled&&(r.since=l.seq,r.onChange(l))}).on("complete",function(){o==="waiting"&&qo(a),o=!1}).on("error",s)}this._listeners[n]=a,this.on(e,a)};Qe.prototype.removeListener=function(e,n){n in this._listeners&&(un.EventEmitter.prototype.removeListener.call(this,e,this._listeners[n]),delete this._listeners[n])};Qe.prototype.notifyLocalWindows=function(e){it()?chrome.storage.local.set({dbName:e}):pr()&&(localStorage[e]=localStorage[e]==="a"?"b":"a")};Qe.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};fa.v4;function ot(e,n){for(var t=e,r=0,i=n.length;r<i;r++){var o=n[r];if(t=t[o],!t)break}return t}function ga(e,n,t){for(var r=0,i=n.length;r<i-1;r++){var o=n[r];e=e[o]={}}e[n[i-1]]=t}function hr(e,n){return e<n?-1:e>n?1:0}function at(e){for(var n=[],t="",r=0,i=e.length;r<i;r++){var o=e[r];o==="."?r>0&&e[r-1]==="\\"?t=t.substring(0,t.length-1)+".":(n.push(t),t=""):t+=o}return n.push(t),n}var ma=["$or","$nor","$not"];function ut(e){return ma.indexOf(e)>-1}function st(e){return Object.keys(e)[0]}function gr(e){return e[st(e)]}function on(e){var n={};return e.forEach(function(t){Object.keys(t).forEach(function(r){var i=t[r];if(typeof i!="object"&&(i={$eq:i}),ut(r))i instanceof Array?n[r]=i.map(function(a){return on([a])}):n[r]=on([i]);else{var o=n[r]=n[r]||{};Object.keys(i).forEach(function(a){var u=i[a];if(a==="$gt"||a==="$gte")return _a(a,u,o);if(a==="$lt"||a==="$lte")return $a(a,u,o);if(a==="$ne")return wa(u,o);if(a==="$eq")return ba(u,o);o[a]=u})}})}),n}function _a(e,n,t){typeof t.$eq<"u"||(typeof t.$gte<"u"?e==="$gte"?n>t.$gte&&(t.$gte=n):n>=t.$gte&&(delete t.$gte,t.$gt=n):typeof t.$gt<"u"?e==="$gte"?n>t.$gt&&(delete t.$gt,t.$gte=n):n>t.$gt&&(t.$gt=n):t[e]=n)}function $a(e,n,t){typeof t.$eq<"u"||(typeof t.$lte<"u"?e==="$lte"?n<t.$lte&&(t.$lte=n):n<=t.$lte&&(delete t.$lte,t.$lt=n):typeof t.$lt<"u"?e==="$lte"?n<t.$lt&&(delete t.$lt,t.$lte=n):n<t.$lt&&(t.$lt=n):t[e]=n)}function wa(e,n){"$ne"in n?n.$ne.push(e):n.$ne=[e]}function ba(e,n){delete n.$gt,delete n.$gte,delete n.$lt,delete n.$lte,delete n.$ne,n.$eq=e}function mr(e){var n=Gn(e),t=!1;"$and"in n&&(n=on(n.$and),t=!0),["$or","$nor"].forEach(function(u){u in n&&n[u].forEach(function(s){for(var l=Object.keys(s),w=0;w<l.length;w++){var y=l[w],g=s[y];(typeof g!="object"||g===null)&&(s[y]={$eq:g})}})}),"$not"in n&&(n.$not=on([n.$not]));for(var r=Object.keys(n),i=0;i<r.length;i++){var o=r[i],a=n[o];typeof a!="object"||a===null?a={$eq:a}:"$ne"in a&&!t&&(a.$ne=[a.$ne]),n[o]=a}return n}function _r(e){function n(t){return e.map(function(r){var i=st(r),o=at(i),a=ot(t,o);return a})}return function(t,r){var i=n(t.doc),o=n(r.doc),a=H(i,o);return a!==0?a:hr(t.doc._id,r.doc._id)}}function $r(e,n,t){if(e=e.filter(function(a){return le(a.doc,n.selector,t)}),n.sort){var r=_r(n.sort);e=e.sort(r),typeof n.sort[0]!="string"&&gr(n.sort[0])==="desc"&&(e=e.reverse())}if("limit"in n||"skip"in n){var i=n.skip||0,o=("limit"in n?n.limit:e.length)+i;e=e.slice(i,o)}return e}function le(e,n,t){return t.every(function(r){var i=n[r],o=at(r),a=ot(e,o);return ut(r)?ka(r,i,e):Kn(i,e,o,a)})}function Kn(e,n,t,r){return e?Object.keys(e).every(function(i){var o=e[i];return xa(i,n,o,t,r)}):!0}function ka(e,n,t){return e==="$or"?n.some(function(r){return le(t,r,Object.keys(r))}):e==="$not"?!le(t,n,Object.keys(n)):!n.find(function(r){return le(t,r,Object.keys(r))})}function xa(e,n,t,r,i){if(!Ct[e])throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return Ct[e](n,t,r,i)}function Ae(e){return typeof e<"u"&&e!==null}function se(e){return typeof e<"u"}function Oa(e,n){var t=n[0],r=n[1];if(t===0)throw new Error("Bad divisor, cannot divide by zero");if(parseInt(t,10)!==t)throw new Error("Divisor is not an integer");if(parseInt(r,10)!==r)throw new Error("Modulus is not an integer");return parseInt(e,10)!==e?!1:e%t===r}function Tt(e,n){return n.some(function(t){return e instanceof Array?e.indexOf(t)>-1:e===t})}function Ea(e,n){return n.every(function(t){return e.indexOf(t)>-1})}function Aa(e,n){return e.length===n}function Sa(e,n){var t=new RegExp(n);return t.test(e)}function Ia(e,n){switch(n){case"null":return e===null;case"boolean":return typeof e=="boolean";case"number":return typeof e=="number";case"string":return typeof e=="string";case"array":return e instanceof Array;case"object":return{}.toString.call(e)==="[object Object]"}throw new Error(n+" not supported as a type.Please use one of object, string, array, number, boolean or null.")}var Ct={$elemMatch:function(e,n,t,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"?r.some(function(i){return le(i,n,Object.keys(n))}):r.some(function(i){return Kn(n,e,t,i)})},$allMatch:function(e,n,t,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"?r.every(function(i){return le(i,n,Object.keys(n))}):r.every(function(i){return Kn(n,e,t,i)})},$eq:function(e,n,t,r){return se(r)&&H(r,n)===0},$gte:function(e,n,t,r){return se(r)&&H(r,n)>=0},$gt:function(e,n,t,r){return se(r)&&H(r,n)>0},$lte:function(e,n,t,r){return se(r)&&H(r,n)<=0},$lt:function(e,n,t,r){return se(r)&&H(r,n)<0},$exists:function(e,n,t,r){return n?se(r):!se(r)},$mod:function(e,n,t,r){return Ae(r)&&Oa(r,n)},$ne:function(e,n,t,r){return n.every(function(i){return H(r,i)!==0})},$in:function(e,n,t,r){return Ae(r)&&Tt(r,n)},$nin:function(e,n,t,r){return Ae(r)&&!Tt(r,n)},$size:function(e,n,t,r){return Ae(r)&&Aa(r,n)},$all:function(e,n,t,r){return Array.isArray(r)&&Ea(r,n)},$regex:function(e,n,t,r){return Ae(r)&&Sa(r,n)},$type:function(e,n,t,r){return Ia(r,n)}};function ja(e,n){if(typeof n!="object")throw new Error("Selector error: expected a JSON object");n=mr(n);var t={doc:e},r=$r([t],{selector:n},Object.keys(n));return r&&r.length===1}const Fa=Object.freeze(Object.defineProperty({__proto__:null,compare:hr,createFieldSorter:_r,filterInMemoryFields:$r,getFieldFromDoc:ot,getKey:st,getValue:gr,isCombinationalField:ut,massageSelector:mr,matchesSelector:ja,parseField:at,rowFilter:le,setFieldInDoc:ga},Symbol.toStringTag,{value:"Module"})),ft=Bt(Fa);var Me={},pn=ft,Nt=pn.getKey,Ta=pn.getFieldFromDoc,Ca=pn.setFieldInDoc,Na=pn.parseField;Me.getUserFields=function(e,n){var t=Object.keys(e),r=n?n.map(Nt):[],i;return t.length>=r.length?i=t:i=r,r.length===0?{fields:i}:(i=i.sort(function(o,a){var u=r.indexOf(o);u===-1&&(u=Number.MAX_VALUE);var s=r.indexOf(a);return s===-1&&(s=Number.MAX_VALUE),u<s?-1:u>s?1:0}),{fields:i,sortOrder:n.map(Nt)})};Me.massageSort=function(e){if(!Array.isArray(e))throw new Error("invalid sort json - should be an array");return e.map(function(n){if(typeof n=="string"){var t={};return t[n]="asc",t}else return n})};Me.pick=function(e,n){for(var t={},r=0,i=n.length;r<i;r++){var o=Na(n[r]),a=Ta(e,o);typeof a<"u"&&Ca(t,o,a)}return t};var Pa=rr.collate,qe=ft,La=qe.filterInMemoryFields,Ba=Me,Ra=qe.compare,Ua=Ba.getUserFields,za=qe.getKey,Qa=qe.getValue,Ma=qe.parseField,qa=nt.memoryFilter=function(e,n){var t=Ua(n.selector,n.sort),r=t.fields,i=e.map(function(o){return{doc:o}});return La(i,n,r).map(function(o){return o.doc})},Ja=nt.createFieldSorter=function(e){function n(r){return e.map(function(i){var o=za(i),a=Ma(o),u=Ga(r,a);return u})}var t=e.map(function(r){return typeof r!="string"&&Qa(r)==="desc"?-1:1});return function(r,i){for(var o=n(r),a=n(i),u=0,s=t.length;u<s;u++){var l=Pa(o[u],a[u]);if(l!==0)return l*t[u]}return Ra(r._id,i._id)*t[0]}};function Ga(e,n){for(var t=e,r=0,i=n.length;r<i;r++){var o=n[r];if(t=t[o],!t)break}return t}(function(e){var n=un,t=nt;rr.collate;var r=ft,i=Me;r.getValue;var o=r.massageSelector,a=i.massageSort;function u(s){if(typeof this.find!="function")throw new Error("ERROR: PouchDB Find is a requirement for LiveFind and must be loaded first.");var l=this,w=!1,y={},g=new n,O=[],j=s.aggregate||!1,k=s.fields,E=!1,x=!1;k&&(k.indexOf("_id")===-1&&(k.unshift("_id"),E=!0),k.indexOf("_rev")===-1&&(k.push("_rev"),x=!0));var L;s.selector&&(L=o(s.selector));var R,Z;s.sort&&(R=a(s.sort),Z=t.createFieldSorter(R));var X=parseInt(s.skip,10)||0,D=parseInt(s.limit,10)||0,ee={selector:L,fields:k},J=l.find(ee).then(function(v){v.docs.forEach(function($){mn($)}),g.emit("ready")}).catch(function(v){throw g.emit("error",v),he(),v});l._changeListener||hn(),l._activeQueries?l._activeQueries++:l._activeQueries=1,l._changeListener.on("change",pe).on("error",Je),g.cancel=he,g.then=J.then.bind(J),g.catch=J.catch.bind(J),g.sort=function(v){return R?d(v):v},g.paginate=b;function pe(v){J.then(function(){v.doc&&_n(v.doc)})}function Je(v){g.emit("error",v)}function he(){w||(l._activeQueries--,l._activeQueries?(l._changeListener.removeListener("change",pe),l._changeListener.removeListener("error",Je)):(l._changeListener.cancel(),delete l._changeListener),g.emit("cancelled"),g.removeAllListeners(),w=!0)}function hn(){l._changeListener=l.changes({live:!0,retry:!0,include_docs:!0,since:"now"})}function gn(v){var $=t.memoryFilter([v],{selector:L});return $.length?$[0]:null}function Ge(v){if(k){var $=i.pick(v,k);return E&&delete $._id,x&&delete $._rev,$}return v}function mn(v){y[v._id]=v._rev;var $=v._id,h=v._rev;return E&&delete v._id,x&&delete v._rev,f(v,$,h)}function _n(v){if(y[v._id]!==v._rev){var $=v._id,h=v._rev;if(v._deleted&&y[$])return y[$]=null,Ke({_id:$,_rev:h,deleted:!0},$,h);var m=gn(v);if(!m&&y[$])return y[$]=null,Ke({_id:$,_rev:h},$,h);if(m&&!y[$])return y[$]=h,f(Ge(m),$,h);if(m&&y[$])return y[$]=h,c(Ge(m),$,h)}}function Ke(v,$,h){var m;j&&(O=O.filter(function(_){return _._id!==v._id}),m=p(O)),g.emit("update",{action:"REMOVE",id:$,rev:h,doc:v},m)}function f(v,$,h){var m;j&&(O=O.concat(v),m=p(O)),g.emit("update",{action:"ADD",id:$,rev:h,doc:v},m)}function c(v,$,h){var m;j&&(O=O.map(function(_){return _._id===v._id?v:_}),m=p(O)),g.emit("update",{action:"UPDATE",id:$,rev:h,doc:v},m)}function d(v){return v.sort(Z)}function p(v){return R&&(v=d(v)),(X||D)&&(D?v=v.slice(X,X+D):v=v.slice(X)),v}function b(v){if(!(!j||!v||typeof v!="object"))return v.skip!=null&&(X=parseInt(v.skip,10)||0),v.limit!=null&&(D=parseInt(v.limit,10)||0),v.sort&&v.sort instanceof Array&&(R=a(v.sort),Z=t.createFieldSorter(R)),p(O)}return g}e.liveFind=u,typeof window<"u"&&window.PouchDB&&window.PouchDB.plugin(e)})(nr);const Ka=an(nr),{massageSelector:Ha,massageSort:Da}=mi;function Xa(e){e.prototype.asSvelteStore=function(n){const t=this;let r;const i=br([],s=>{s||t.close()});t.deltaInit(),t.delta.on("create",s=>{o(s)&&(r[s.$id]=s,a())}).on("update",s=>{const l={...r[s.$id],...s};o(l)?r[s.$id]=l:delete r[s.$id],a()}).on("delete",s=>{delete r[s],a()});function o(s){return n==null?!0:qa([s],n).length>0}function a(){console.log(r);const s=Object.values(r);n.sortFn&&s.sort(n.sortFn),i.set(s)}async function u(s){if(s){n=s?{...n??{},...s}:n,n.selector&&(n.selector=Ha(n.selector)),n.sort&&(n.sortFn=Ja(n.sort)),r={};const{docs:l,warning:w}=await t.find(n);w&&console.warn(w),l.forEach(y=>r[y.$id]=y)}else r=await t.all();a()}return u(n),{subscribe:i.subscribe,updateSearch:u}}}function Pt(e,n,t){const r=e.slice();return r[11]=n[t],r}function Lt(e,n){let t,r=JSON.stringify(n[11])+"",i,o,a=n[11].$id+"",u,s,l,w,y,g,O,j;function k(...x){return n[9](n[11],...x)}function E(){return n[10](n[11])}return{key:e,first:null,c(){t=ie("div"),i=Sn(r),o=je(),u=Sn(a),s=je(),l=ie("input"),y=je(),g=ie("button"),g.textContent="❎",l.value=w=n[11].title,this.first=t},m(x,L){ne(x,t,L),te(t,i),ne(x,o,L),ne(x,u,L),ne(x,s,L),ne(x,l,L),ne(x,y,L),ne(x,g,L),O||(j=[Fe(l,"change",k),Fe(g,"click",E)],O=!0)},p(x,L){n=x,L&4&&r!==(r=JSON.stringify(n[11])+"")&&lt(i,r),L&4&&a!==(a=n[11].$id+"")&&lt(u,a),L&4&&w!==(w=n[11].title)&&l.value!==w&&(l.value=w)},d(x){x&&re(t),x&&re(o),x&&re(u),x&&re(s),x&&re(l),x&&re(y),x&&re(g),O=!1,Rt(j)}}}function Wa(e){let n,t,r,i,o,a,u,s,l=[],w=new Map,y,g,O=e[2];const j=k=>k[11].$id;for(let k=0;k<O.length;k+=1){let E=Pt(e,O,k),x=j(E);w.set(x,l[k]=Lt(x,E))}return{c(){n=ie("div"),t=ie("input"),r=ie("button"),r.textContent="Submit",i=je(),o=ie("label"),a=Sn(`Filter
        `),u=ie("input"),s=je();for(let k=0;k<l.length;k+=1)l[k].c()},m(k,E){ne(k,n,E),te(n,t),We(t,e[1]),te(n,r),te(n,i),te(n,o),te(o,a),te(o,u),We(u,e[0]),te(n,s);for(let x=0;x<l.length;x+=1)l[x]&&l[x].m(n,null);y||(g=[Fe(t,"input",e[6]),Fe(r,"click",e[7]),Fe(u,"input",e[8])],y=!0)},p(k,[E]){E&2&&t.value!==k[1]&&We(t,k[1]),E&1&&u.value!==k[0]&&We(u,k[0]),E&44&&(O=k[2],l=Er(l,E,j,1,k,O,w,n,Ir,Lt,null,Pt))},i:ct,o:ct,d(k){k&&re(n);for(let E=0;E<l.length;E+=1)l[E].d();y=!1,Rt(g)}}}function Ya(e,n,t){let r;Oe.plugin(Ar),Oe.plugin(we),Oe.plugin(Ka),Oe.plugin(Xa);const i=new Oe("test"),o=i.asSvelteStore();Sr(e,o,j=>t(2,r=j));let a,u;function s(j=void 0,k=void 0){i.save({$id:j,title:k??a}).then(function(E){console.log(E)})}function l(){a=this.value,t(1,a)}const w=()=>s();function y(){u=this.value,t(0,u)}const g=(j,k)=>s(j.$id,k.target.value),O=j=>i.delete(j.$id).then(console.log);return e.$$.update=()=>{e.$$.dirty&1&&o.updateSearch({selector:{title:u}})},[u,a,r,i,o,s,l,w,y,g,O]}class eu extends kr{constructor(n){super(),xr(this,n,Ya,Wa,Or,{})}}export{eu as default};
